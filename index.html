<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma Pr√°tica: Seguran√ßa da Informa√ß√£o</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto+Slab:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üõ°Ô∏è</text></svg>">
</head>
<body>
    <button id="theme-toggle-button" title="Alternar Tema">üåô</button>

    <div class="mode-selection-overlay visible" id="mode-selection-screen">
        <div class="mode-selection-box">
            <h2>Seguran√ßa da Informa√ß√£o - Praticar</h2>
            <p style="margin-bottom: 20px; font-size: 0.95em; color: var(--text-secondary);">Escolha o modo para iniciar o simulado:</p>
            <button class="mode-button" id="start-timed-button">Com Tempo (50 Minutos) PROVA</button>
            <button class="mode-button secondary" id="start-untimed-button">Sem Tempo - Teste</button>
        </div>
    </div>

    <div class="quiz-main-container" id="quiz-main-container" style="display: none;">
        <header class="page-header-container">
            <div class="header-content">
                <button id="back-button" class="back-button" style="display: none;">Voltar</button>
                <h1 class="page-main-title">Plataforma Pr√°tica: Seguran√ßa da Informa√ß√£o</h1>
                <div style="width: 80px; flex-shrink: 0;"></div>
            </div>
        </header>

        <div class="quiz-page-container">
            <div class="questions-area" id="questions-area-main">
            </div>
            <div class="sidebar-area">
                <div id="timer-display-container" style="display: none;">
                    <div id="timer-display">50:00</div>
                </div>
                <div id="question-nav-header">Navega√ß√£o</div>
                <div id="question-nav-grid">
                </div>
                <div class="status-summary">
                    <p><span class="status-dot answered-dot"></span> Respondidas: <strong id="answered-count">0</strong></p>
                    <p><span class="status-dot review-dot"></span> Revis√£o: <strong id="review-count">0</strong></p>
                    <p><span class="status-dot blank-dot"></span> Em branco: <strong id="blank-count">0</strong></p>
                </div>
                <div class="probability-legend" id="probability-legend-container" style="display: none;">
                    <p style="font-weight: 600; margin-bottom: 5px; color: var(--text-primary);">Legenda de Probabilidade (Modo SEM TEMPO):</p>
                    <p><span class="legend-color-box prob-high-legend"></span> Maior chance</p>
                    <p><span class="legend-color-box prob-medium-legend"></span> Chance m√©dia</p>
                    <p><span class="legend-color-box prob-low-legend"></span> Menor chance</p>
                </div>
                <div class="sidebar-buttons-container">
                    <button id="finalize-button" class="sidebar-button" title="Responda todas as quest√µes para finalizar">Finalizar prova</button>
                    <button id="restart-button" class="sidebar-button" style="display: none;">Voltar ao In√≠cio</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="page-footer">
        <p>Desenvolvido por Marcos Vinicius - Estudante de An√°lise e Desenvolvimento de Sistemas - <a href="https://www.linkedin.com/in/marcosvinicius2030" target="_blank" rel="noopener noreferrer">LinkedIn</a></p>
    </footer>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Roboto+Slab:wght@400;600;700&display=swap');

:root {
    /* Light Theme (Default) */
    --font-sans: 'Inter', sans-serif;
    --font-serif: 'Roboto Slab', serif;
    --bg-light-primary: #ffffff;
    --bg-light-secondary: #f8f9fc;
    --bg-light-tertiary: #f1f3f6;
    --text-light-primary: #1f2328;
    --text-light-secondary: #57606a;
    --text-light-tertiary: #8c95a1;
    --border-light-primary: #dfe3e8;
    --border-light-secondary: #ced4da;
    --accent-light-primary: #007aff;
    --accent-light-primary-darker: #005ecb;
    --accent-light-primary-lighter: #e6f2ff;
    --feedback-correct-light: #34c759;
    --feedback-correct-bg-light: #eaf7ec;
    --feedback-correct-text-light: #1c6c37;
    --feedback-incorrect-light: #ff3b30;
    --feedback-incorrect-bg-light: #ffebee;
    --feedback-incorrect-text-light: #a6130a;
    --feedback-review-light: #ffcc00;
    --feedback-review-bg-light: #fff9e6;
    --feedback-review-text-light: #7a5f00;
    --prob-high-light: #ff3b30;
    --prob-high-bg-light: #ffebee;
    --prob-medium-light: #ffcc00;
    --prob-medium-bg-light: #fff9e6;
    --prob-low-light: #34c759;
    --prob-low-bg-light: #eaf7ec;
    --bg-dark-primary: #161b22;
    --bg-dark-secondary: #0d1117;
    --bg-dark-tertiary: #21262d;
    --text-dark-primary: #c9d1d9;
    --text-dark-secondary: #8b949e;
    --text-dark-tertiary: #6e7681;
    --border-dark-primary: #30363d;
    --border-dark-secondary: #49515a;
    --accent-dark-primary: #58a6ff;
    --accent-dark-primary-darker: #388bfd;
    --accent-dark-primary-lighter: #1e4278;
    --feedback-correct-dark: #56d364;
    --feedback-correct-bg-dark: #1c3027;
    --feedback-correct-text-dark: #7ee787;
    --feedback-incorrect-dark: #f85149;
    --feedback-incorrect-bg-dark: #382025;
    --feedback-incorrect-text-dark: #ffa198;
    --feedback-review-dark: #e3b341;
    --feedback-review-bg-dark: #342f20;
    --feedback-review-text-dark: #f0c659;
    --prob-high-dark: #f85149;
    --prob-high-bg-dark: #382025;
    --prob-medium-dark: #e3b341;
    --prob-medium-bg-dark: #342f20;
    --prob-low-dark: #56d364;
    --prob-low-bg-dark: #1c3027;
    --bg-page: var(--bg-light-secondary);
    --bg-header: var(--bg-light-primary);
    --bg-card: var(--bg-light-primary);
    --bg-sidebar: var(--bg-light-primary);
    --bg-element: var(--bg-light-tertiary);
    --bg-hover: var(--accent-light-primary-lighter);
    --bg-selected: var(--accent-light-primary-lighter);
    --text-primary: var(--text-light-primary);
    --text-secondary: var(--text-light-secondary);
    --text-tertiary: var(--text-light-tertiary);
    --border: var(--border-light-primary);
    --border-medium: var(--border-light-secondary);
    --accent-primary: var(--accent-light-primary);
    --accent-primary-darker: var(--accent-light-primary-darker);
    --feedback-correct: var(--feedback-correct-light);
    --feedback-correct-bg: var(--feedback-correct-bg-light);
    --feedback-correct-text: var(--feedback-correct-text-light);
    --feedback-incorrect: var(--feedback-incorrect-light);
    --feedback-incorrect-bg: var(--feedback-incorrect-bg-light);
    --feedback-incorrect-text: var(--feedback-incorrect-text-light);
    --feedback-review: var(--feedback-review-light);
    --feedback-review-bg: var(--feedback-review-bg-light);
    --feedback-review-text: var(--feedback-review-text-light);
    --prob-high-accent: var(--prob-high-light);
    --prob-high-background: var(--prob-high-bg-light);
    --prob-medium-accent: var(--prob-medium-light);
    --prob-medium-background: var(--prob-medium-bg-light);
    --prob-low-accent: var(--prob-low-light);
    --prob-low-background: var(--prob-low-bg-light);
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 8px rgba(0,0,0,0.05), 0 2px 4px rgba(0,0,0,0.04);
    --shadow-lg: 0 10px 20px rgba(0,0,0,0.06), 0 4px 8px rgba(0,0,0,0.05);
    --border-radius-sm: 4px;
    --border-radius-md: 8px;
    --border-radius-lg: 12px;
    --important-q-accent: var(--feedback-review-light);
}

body.dark-theme {
    --bg-page: var(--bg-dark-secondary);
    --bg-header: var(--bg-dark-primary);
    --bg-card: var(--bg-dark-primary);
    --bg-sidebar: var(--bg-dark-primary);
    --bg-element: var(--bg-dark-tertiary);
    --bg-hover: var(--accent-dark-primary-lighter);
    --bg-selected: var(--accent-dark-primary-lighter);
    --text-primary: var(--text-dark-primary);
    --text-secondary: var(--text-dark-secondary);
    --text-tertiary: var(--text-dark-tertiary);
    --border: var(--border-dark-primary);
    --border-medium: var(--border-dark-secondary);
    --accent-primary: var(--accent-dark-primary);
    --accent-primary-darker: var(--accent-dark-primary-darker);
    --feedback-correct: var(--feedback-correct-dark);
    --feedback-correct-bg: var(--feedback-correct-bg-dark);
    --feedback-correct-text: var(--feedback-correct-text-dark);
    --feedback-incorrect: var(--feedback-incorrect-dark);
    --feedback-incorrect-bg: var(--feedback-incorrect-bg-dark);
    --feedback-incorrect-text: var(--feedback-incorrect-text-dark);
    --feedback-review: var(--feedback-review-dark);
    --feedback-review-bg: var(--feedback-review-bg-dark);
    --feedback-review-text: var(--feedback-review-text-dark);
    --prob-high-accent: var(--prob-high-dark);
    --prob-high-background: var(--prob-high-bg-dark);
    --prob-medium-accent: var(--prob-medium-dark);
    --prob-medium-background: var(--prob-medium-bg-dark);
    --prob-low-accent: var(--prob-low-dark);
    --prob-low-background: var(--prob-low-bg-dark);
    --shadow-sm: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.25);
    --shadow-md: 0 4px 10px rgba(0,0,0,0.3), 0 2px 6px rgba(0,0,0,0.25);
    --shadow-lg: 0 10px 25px rgba(0,0,0,0.35), 0 5px 12px rgba(0,0,0,0.3);
    --important-q-accent: var(--feedback-review-dark);
}

* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body {
    font-family: var(--font-sans);
    background-color: var(--bg-page);
    color: var(--text-primary);
    line-height: 1.65;
    padding: 0;
    transition: background-color 0.2s ease-out, color 0.2s ease-out;
    display: flex;
    flex-direction: column;
    min-height: 100vh;
}
ul { list-style: none; }
button { font-family: inherit; border: none; background: none; cursor: pointer; padding: 0; }

#theme-toggle-button {
    position: fixed; top: 16px; right: 20px;
    background-color: var(--bg-card); color: var(--text-secondary);
    border: 1px solid var(--border); border-radius: var(--border-radius-md);
    width: 40px; height: 40px; font-size: 1.1em;
    display: flex; justify-content: center; align-items: center;
    box-shadow: var(--shadow-sm); transition: all 0.2s ease; z-index: 1002;
}
#theme-toggle-button:hover {
    background-color: var(--bg-element); color: var(--accent-primary); transform: scale(1.08);
}

.mode-selection-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
    display: flex; justify-content: center; align-items: center;
    z-index: 2000; opacity: 0; visibility: hidden;
    transition: opacity 0.25s ease, visibility 0s linear 0.25s;
}
.mode-selection-overlay.visible { opacity: 1; visibility: visible; transition-delay: 0s; }
.mode-selection-box {
    background-color: var(--bg-card); padding: 30px 35px;
    border-radius: var(--border-radius-lg); box-shadow: var(--shadow-lg);
    text-align: center; width: 90%; max-width: 480px;
    transform: scale(0.95); opacity: 0;
    transition: transform 0.3s ease-out 0.1s, opacity 0.3s ease-out 0.1s;
}
.mode-selection-overlay.visible .mode-selection-box { transform: scale(1); opacity: 1; }
.mode-selection-box h2 {
    font-family: var(--font-serif);
    color: var(--text-primary);
    font-size: 1.5em; margin-bottom: 20px; font-weight: 600;
}
.mode-button {
    font-family: var(--font-sans);
    background-color: var(--accent-primary);
    color: #fff; padding: 12px 22px;
    border-radius: var(--border-radius-md); font-size: 0.95em; font-weight: 500;
    margin: 10px auto; transition: background-color 0.2s ease, transform 0.15s ease;
    display: block; width: 100%; max-width: 260px;
    letter-spacing: 0.4px; box-shadow: var(--shadow-sm);
}
.mode-button:hover { background-color: var(--accent-primary-darker); transform: translateY(-2px); }
.mode-button.secondary {
    background-color: var(--bg-element); color: var(--text-primary);
    border: 1.5px solid var(--border-medium);
}
.mode-button.secondary:hover { background-color: var(--border); color: var(--text-primary); }

.page-header-container {
    background-color: var(--bg-header);
    box-shadow: var(--shadow-sm); border-bottom: 1px solid var(--border);
    position: sticky; top: 0; z-index: 1000; width: 100%;
}
.page-header-container .header-content {
    display: flex; justify-content: space-between; align-items: center;
    padding: 10px 20px; /* Reduzido o padding vertical e horizontal */
    max-width: 1550px;
    margin: 0 auto;
}
.back-button, .top-button {
    background-color: var(--bg-element); color: var(--text-primary);
    border: 1px solid var(--border-medium); border-radius: var(--border-radius-md);
    padding: 6px 12px; /* Reduzido o padding */
    font-size: 0.85em; /* Reduzido o tamanho da fonte */
    font-weight: 500;
    cursor: pointer; transition: all 0.2s ease;
    flex-shrink: 0; /* Para n√£o encolher */
    white-space: nowrap; /* Evitar quebra de linha no texto do bot√£o */
}
.back-button:hover, .top-button:hover {
    background-color: var(--border); color: var(--text-primary); transform: translateY(-1px);
}
.header-placeholder { /* Usado para balancear o t√≠tulo quando s√≥ h√° um bot√£o */
    width: 80px; /* Ajustar para corresponder √† largura aproximada do .back-button ou .top-button */
    flex-shrink: 0;
}


.quiz-main-container {
    display: none;
    flex-direction: column;
    flex-grow: 1;
    width: 100%;
}
.quiz-page-container {
    display: flex;
    flex-grow: 1;
    max-width: 1550px; margin: 15px auto 0 auto; /* Margem superior reduzida */
    background-color: transparent; box-shadow: none; border-radius: 0;
    padding: 0 15px;
}
.questions-area {
    flex: 1;
    max-width: calc(100% - 360px);
    padding-right: 15px;
    background-color: transparent;
}
.sidebar-area {
    flex-basis: 340px;
    flex-shrink: 0;
    background-color: var(--bg-sidebar);
    padding: 20px;
    border-radius: var(--border-radius-lg);
    box-shadow: var(--shadow-md);
    position: sticky;
    /* top: 75px;  Ajustar dinamicamente ou com base na altura real do header */
    /* Altura do header: padding (10*2) + font-size (1.4em * line-height ~1.2) + border (1) ~ 20 + 23 + 1 = 44px */
    /* Margem do quiz-page-container: 15px. Total: 44 + 15 = 59px. Usar ~60px ou 65px */
    top: 65px;
    height: calc(100vh - (65px + 20px)); /* top + margem inferior da sidebar */
    overflow-y: auto;
}

.question-block {
    background-color: var(--bg-card); border: 1px solid var(--border);
    border-radius: var(--border-radius-md); margin-bottom: 20px; /* Reduzido */
    padding: 18px 22px; /* Reduzido */
    box-shadow: var(--shadow-sm);
    transition: box-shadow 0.2s ease, transform 0.2s ease;
    position: relative; overflow: hidden;
}
.question-block.prob-high { border-left: 5px solid var(--prob-high-accent); background-color: var(--prob-high-background); }
.question-block.prob-medium { border-left: 5px solid var(--prob-medium-accent); background-color: var(--prob-medium-background); }
.question-block.prob-low { border-left: 5px solid var(--prob-low-accent); background-color: var(--prob-low-background); }
.question-block.important-question {
    border-left: 5px solid var(--important-q-accent);
}
body.dark-theme .question-block.important-question {
    border-left: 5px solid var(--important-q-accent);
}

.question-block:hover:not(.quiz-finalized .question-block) {
    transform: translateY(-2px); box-shadow: var(--shadow-md);
}
.question-block-header {
    display: flex; justify-content: space-between; align-items: center;
    margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid var(--border);
}
.question-block-number {
    font-family: var(--font-sans);
    font-size: 1.1em; font-weight: 600; color: var(--accent-primary);
}
.question-block-number.highlight-red { color: var(--feedback-incorrect); }
.question-block.important-question .question-block-number:not(.highlight-red) {
     color: var(--important-q-accent) !important;
}
.question-block.important-question.highlight-red .question-block-number {
    color: var(--feedback-incorrect) !important;
}

.question-block-review-btn {
    font-family: var(--font-sans); background-color: transparent; color: var(--text-secondary);
    border: 1.5px solid var(--border-medium); padding: 4px 10px; border-radius: var(--border-radius-lg);
    font-size: 0.65em; font-weight: 500; letter-spacing: 0.3px; transition: all 0.2s ease;
}
.question-block-review-btn:hover:not(:disabled) {
    background-color: var(--bg-hover); border-color: var(--accent-primary); color: var(--accent-primary);
}
.question-block-review-btn.marked {
    background-color: var(--feedback-review-bg); border-color: var(--feedback-review); color: var(--feedback-review-text);
}
.question-block-review-btn:disabled { opacity: 0.7; cursor: not-allowed; }
.question-block-text {
    margin-bottom: 15px; font-size: 0.95em; color: var(--text-primary); line-height: 1.65;
}
.question-block-text strong { font-weight: 600; }
.question-block-text .source-reference {
    font-size: 0.7em; color: var(--text-tertiary); margin-top: 8px; display: block; font-style: italic;
}

.option-item {
    background-color: var(--bg-card); border: 1.5px solid var(--border); border-radius: var(--border-radius-md);
    padding: 10px 12px; margin-bottom: 6px; display: flex; align-items: center; cursor: pointer;
    transition: all 0.15s ease-in-out;
}
.question-block.prob-high .option-item,
.question-block.prob-medium .option-item,
.question-block.prob-low .option-item {
    background-color: var(--bg-card);
}
.option-item:hover:not(.quiz-finalized .option-item) {
    border-color: var(--accent-primary); background-color: var(--bg-hover);
}
.option-item.selected:not(.quiz-finalized .option-item) {
    border-color: var(--accent-primary) !important; background-color: var(--bg-selected) !important;
}
.option-item.selected:not(.quiz-finalized .option-item) .option-letter {
    background-color: var(--accent-primary); color: var(--bg-card);
}
.option-letter {
    font-family: var(--font-sans); background-color: var(--bg-element); color: var(--text-secondary);
    border-radius: 50%; min-width: 22px; height: 22px; display: inline-flex;
    justify-content: center; align-items: center; font-weight: 500;
    margin-right: 8px; font-size: 0.7em; transition: background-color 0.2s, color 0.2s;
}
.option-text { font-size: 0.85em; color: var(--text-primary); flex-grow: 1; }

.gabarito-feedback {
    margin-top: 12px; padding: 10px 12px; border-radius: var(--border-radius-sm); font-size: 0.85em;
    border-left-width: 4px; border-left-style: solid;
}
.gabarito-feedback.correct { background-color: var(--feedback-correct-bg); color: var(--feedback-correct-text); border-left-color: var(--feedback-correct); }
.gabarito-feedback.incorrect { background-color: var(--feedback-incorrect-bg); color: var(--feedback-incorrect-text); border-left-color: var(--feedback-incorrect); }
.gabarito-feedback p { margin: 3px 0; }
.gabarito-feedback strong { font-weight: 600; }
.gabarito-feedback .gabarito-comentario {
    margin-top: 6px; padding-top: 6px; border-top: 1px dashed var(--border);
    font-size: 0.8em; color: var(--text-secondary);
}
.quiz-finalized .option-item { cursor: default; }
.quiz-finalized .option-item.selected { box-shadow: none; }
.quiz-finalized .option-item.user-correct { background-color: var(--feedback-correct-bg) !important; border-color: var(--feedback-correct) !important; }
.quiz-finalized .option-item.user-correct .option-letter { background-color: var(--feedback-correct) !important; color: var(--bg-card) !important; }
.quiz-finalized .option-item.user-incorrect { background-color: var(--feedback-incorrect-bg) !important; border-color: var(--feedback-incorrect) !important; opacity: 0.9; }
.quiz-finalized .option-item.user-incorrect .option-letter { background-color: var(--feedback-incorrect) !important; color: var(--bg-card) !important; }
.quiz-finalized .option-item.actual-correct {
    border-width: 1.5px;
    border-color: var(--feedback-correct) !important;
}
.quiz-finalized .option-item.actual-correct:not(.user-correct) .option-letter {
    background-color: var(--feedback-correct) !important;
    color: var(--bg-card) !important;
}

#question-nav-header {
    font-family: var(--font-sans); font-size: 1.05em; font-weight: 600;
    margin-bottom: 10px; color: var(--text-primary); padding-bottom: 6px;
    border-bottom: 1px solid var(--border);
}
#timer-display-container { margin-bottom: 10px; }
#timer-display {
    font-family: var(--font-sans); font-size: 1.2em; font-weight: 700;
    color: var(--accent-primary); text-align: center;
    padding: 5px; background-color: var(--bg-element); border-radius: var(--border-radius-sm);
}
#question-nav-grid {
    display: grid; grid-template-columns: repeat(5, 1fr);
    gap: 5px; margin-bottom: 12px;
}
.nav-grid-button {
    font-family: var(--font-sans); background-color: var(--bg-card); border: 1px solid var(--border);
    color: var(--text-secondary); padding: 4px 0; border-radius: var(--border-radius-sm);
    text-align: center; cursor: pointer; font-size: 0.75em; font-weight: 500;
    transition: all 0.15s ease-out;
}
.nav-grid-button:hover:not(.quiz-finalized .nav-grid-button) {
    background-color: var(--bg-hover); color: var(--accent-primary); border-color: var(--accent-primary);
}
.nav-grid-button.answered:not(.quiz-finalized .nav-grid-button) {
    background-color: var(--accent-primary); color: var(--bg-card); border-color: var(--accent-primary-darker);
}
.nav-grid-button.review:not(.quiz-finalized .nav-grid-button) {
    border-color: var(--feedback-review); background-color: var(--feedback-review-bg); color: var(--feedback-review-text);
}
.quiz-finalized .nav-grid-button.nav-grid-correct {
    background-color: var(--feedback-correct-bg); border-color: var(--feedback-correct); color: var(--feedback-correct-text); font-weight: 600;
}
.quiz-finalized .nav-grid-button.nav-grid-incorrect {
    background-color: var(--feedback-incorrect-bg); border-color: var(--feedback-incorrect); color: var(--feedback-incorrect-text); font-weight: 600;
}
.quiz-finalized .nav-grid-button.nav-grid-unanswered {
    background-color: var(--bg-element); border-color: var(--border); color: var(--text-tertiary); opacity: 0.8;
}

.status-summary p {
    font-family: var(--font-sans); font-size: 0.75em; margin: 4px 0; display: flex;
    align-items: center; color: var(--text-secondary);
}
.status-summary p strong { font-weight: 600; margin-left: 4px; color: var(--text-primary); }
.status-dot { display: inline-block; width: 6px; height: 6px; border-radius: 50%; margin-right: 5px;}
.answered-dot { background-color: var(--accent-primary); }
.review-dot { background-color: var(--feedback-review); }
.blank-dot { background-color: var(--text-tertiary); }

.probability-legend { margin-top: 12px; font-size: 0.7em; color: var(--text-secondary); }
.probability-legend p { margin: 2px 0; display: flex; align-items: center; }
.legend-color-box { width: 9px; height: 9px; margin-right: 4px; border: 1px solid var(--border); }
.prob-high-legend { background-color: var(--prob-high-accent); }
.prob-medium-legend { background-color: var(--prob-medium-accent); }
.prob-low-legend { background-color: var(--prob-low-accent); }

.sidebar-buttons-container { margin-top: auto; padding-top: 10px; border-top: 1px solid var(--border); }
.sidebar-button {
    font-family: var(--font-sans); color: #fff;
    border: none; padding: 9px 0;
    width: 100%; border-radius: var(--border-radius-md);
    cursor: pointer; font-size: 0.8em; font-weight: 600;
    margin-top: 6px;
    transition: all 0.2s ease; text-transform: uppercase; letter-spacing: 0.5px;
    box-shadow: var(--shadow-sm);
}
.sidebar-button:first-child { margin-top: 0; }
.sidebar-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: var(--shadow-md); }
.sidebar-button:active:not(:disabled) { transform: translateY(0px); box-shadow: var(--shadow-sm); }
.sidebar-button:disabled {
    background-color: var(--border-medium) !important; color: var(--text-tertiary) !important;
    cursor: not-allowed; transform: none; box-shadow: none;
}
#finalize-button { background-color: var(--feedback-correct); }
#finalize-button:hover:not(:disabled) { background-color: #109d68; }
body.dark-theme #finalize-button { background-color: var(--feedback-correct-dark); }
body.dark-theme #finalize-button:hover:not(:disabled) { background-color: #4CAF50; }

#restart-button { background-color: var(--accent-primary); }
#restart-button:hover:not(:disabled) { background-color: var(--accent-primary-darker); }

#history-analysis-screen {
    padding: 0;
    background-color: var(--bg-page);
    display: none;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
}
#history-analysis-screen .content-wrapper {
    max-width: 1100px; /* Aumentado um pouco */
    margin: 0 auto;
    padding: 20px;
    width: 100%;
    /* background-color: var(--bg-card); */ /* Removido para usar o do .card-like */
    /* border-radius: var(--border-radius-lg); */
    /* box-shadow: var(--shadow-md); */
    margin-top: 15px; /* Espa√ßo abaixo do header da tela de hist√≥rico */
}
.history-section {
    margin-bottom: 25px;
}
.history-section h3 { /* Estilo para os t√≠tulos das se√ß√µes no hist√≥rico */
    font-family: var(--font-serif);
    font-size: 1.3em;
    color: var(--text-primary);
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border);
}
.card-like { /* Estilo para os cont√™ineres de se√ß√£o parecerem cards */
    background-color: var(--bg-card);
    padding: 20px;
    border-radius: var(--border-radius-md);
    box-shadow: var(--shadow-sm);
}


.history-item {
    border: 1px solid var(--border); border-radius: var(--border-radius-sm);
    padding: 12px 15px; margin-bottom: 10px; background-color: var(--bg-page); font-size: 0.9em;
    box-shadow: var(--shadow-sm);
}
.history-item p { margin: 3px 0; }
.history-item strong { font-weight: 600; color: var(--text-primary); }

.question-stats-container h3 { /* J√° estilizado por .history-section h3 */ }
.question-stat { margin-bottom: 8px; font-size: 0.9em; display:flex; align-items:center; }
.q-label { display: inline-block; width: 220px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; vertical-align: middle; color: var(--text-secondary);}
.bar-container {
    display: inline-block; flex-grow:1; height: 18px;
    background-color: var(--bg-element); border-radius: var(--border-radius-sm); overflow: hidden;
    border: 1px solid var(--border); position: relative; margin: 0 8px;
}
.bar-correct {
    height: 100%; background-color: var(--feedback-correct);
    display: flex; align-items: center; justify-content: flex-end;
    color: white; font-size: 0.75em; padding-right: 5px;
    font-weight: bold;
    white-space: nowrap; transition: width 0.5s ease-out;
    text-shadow: 1px 1px 1px rgba(0,0,0,0.2);
}
.no-history { font-style: italic; color: var(--text-secondary); text-align: center; padding: 25px 0; font-size: 0.95em; }

#review-suggestions-container ul {
    list-style-position: inside;
    padding-left: 5px;
}
#review-suggestions-container li {
    font-size: 0.9em;
    margin-bottom: 5px;
    color: var(--text-secondary);
}
#review-suggestions-container li strong {
    color: var(--text-primary);
}


.page-footer {
    text-align: center; padding: 15px 20px; margin-top: auto;
    background-color: var(--bg-header); color: var(--text-secondary);
    font-size: 0.75em; border-top: 1px solid var(--border);
}
.page-footer p { margin: 0; }


@media (max-width: 1200px) {
    .quiz-page-container {
        flex-direction: column;
        margin: 15px 10px 0 10px;
        border-radius: 0;
    }
    .questions-area {
        max-width: 100%;
        padding-right: 0;
        padding: 0; /* Padding ser√° no question-block ou container interno */
    }
    .sidebar-area {
        width: 100%; max-width: 100%;
        position: static;
        height: auto;
        margin-top: 20px; border-left: none; border-top: 1px solid var(--border);
        border-radius: var(--border-radius-md);
        top: auto;
    }
    #question-nav-grid { grid-template-columns: repeat(auto-fill, minmax(38px, 1fr)); }
    .page-header-container .header-content { padding: 10px 15px; }
    .page-main-title { font-size: 1.2em; margin: 0 8px;}
    .back-button, .top-button { padding: 5px 10px; font-size: 0.8em;}
    .header-placeholder { width: 65px; /* Ajustar para mobile */ }

    #theme-toggle-button { top: 10px; right: 10px;}
    #history-analysis-screen .content-wrapper { margin: 15px; padding: 15px;}
}

@media (max-width: 768px) {
    .page-header-container .header-content { padding: 8px 10px; }
    .page-main-title { font-size: 1.1em; margin: 0 5px; }
    .back-button, .top-button { padding: 4px 8px; font-size: 0.75em;}
    .header-placeholder { width: 55px; /* Ajustar para mobile */ }


    #theme-toggle-button { width: 36px; height: 36px; font-size: 1em; top: 8px; right: 8px;}

    .quiz-page-container { padding: 0 5px; margin-top: 10px; }
    /* .questions-area { padding: 10px; } */ /* Removido, padding no question-block */
    .question-block { padding: 15px; margin-bottom: 15px; }
    .question-block-header { margin-bottom: 10px; padding-bottom: 6px; }
    .question-block-number { font-size: 1em; }
    .question-block-review-btn { font-size: 0.6em; padding: 3px 8px; }
    .question-block-text { font-size: 0.9em; }
    .option-item { padding: 8px 10px; margin-bottom: 5px; }
    .option-letter { min-width: 20px; height: 20px; font-size: 0.65em; margin-right: 6px;}
    .option-text { font-size: 0.8em; }

    .sidebar-area { padding: 15px; }
    #question-nav-header { font-size: 1em; }
    #timer-display { font-size: 1.1em; }
    .sidebar-button { font-size: 0.8em; padding: 9px 0; }

    .mode-selection-box { padding: 20px; width: calc(100% - 20px); }
    .mode-selection-box h2 { font-size: 1.2em; }
    .mode-button { padding: 10px 15px; font-size: 0.9em; }
    .page-footer { padding: 10px; font-size: 0.7em; }

    .q-label { width: 150px; font-size: 0.85em; }
    .bar-container { margin: 0 5px; }
    #history-analysis-screen .content-wrapper { margin: 10px; padding: 10px;}
    .history-section h3 { font-size: 1.15em; margin-bottom: 10px; }
    .card-like { padding: 15px; }
}
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
    const topicProbabilities = {
        CONCEITOS_FUNDAMENTAIS: { level: 'HIGH', colorVarSuffix: 'high' },
        CONTROLES_SEGURANCA:    { level: 'HIGH', colorVarSuffix: 'high' },
        AMEACAS_CRITICAS:       { level: 'HIGH', colorVarSuffix: 'high' },
        GESTAO_RISCO_CRITICA:   { level: 'HIGH', colorVarSuffix: 'high' },
        NORMAS_CRITICAS:        { level: 'HIGH', colorVarSuffix: 'high' },
        AMEACAS_ESPECIFICAS:    { level: 'MEDIUM', colorVarSuffix: 'medium' },
        NORMAS_SEGURANCA:       { level: 'MEDIUM', colorVarSuffix: 'medium' },
        GESTAO_RISCO:           { level: 'MEDIUM', colorVarSuffix: 'medium' },
        GESTAO_CONTINUIDADE:    { level: 'LOW', colorVarSuffix: 'low' }
    };

    const baseFixedQuestions = [
        {
            qIdPrefix: `bfq_`, stableId: `BFQ_CONCEITOS_01_FCC10`, topicKey: 'CONCEITOS_FUNDAMENTAIS',
            originalQNumberDisplay: `1`, highlight: true, sourceRef: `[Fonte: ATIVIDADES PDF, p. 1, Q1]`,
            text: `(FCC/2010) Sobre seguran√ßa da informa√ß√£o, considere:<br><strong>I.</strong> Amea√ßa: algo que possa provocar danos...<br><strong>II.</strong> Vulnerabilidade: √© medida pela probabilidade...<br><strong>III.</strong> Risco: ponto pelo qual algu√©m pode ser atacado...<br>Est√° correto o que consta APENAS em:`,
            options: [ { text: `II e III`, id: `A`, isCorrect: false }, { text: `I e II`, id: `B`, isCorrect: false }, { text: `I e III`, id: `C`, isCorrect: false }, { text: `I`, id: `D`, isCorrect: true },  { text: `III`, id: `E`, isCorrect: false } ],
            gabaritoComentado: `Amea√ßa (I) est√° correta. Vulnerabilidade e Risco est√£o com conceitos trocados em II e III.`
        },
        {
            qIdPrefix: `bfq_`, stableId: `BFQ_AMEACAS_01_UFPB19`, topicKey: 'AMEACAS_CRITICAS',
            originalQNumberDisplay: `5`, highlight: true, sourceRef: `[Fonte: Prova AV.pdf, p. 3, Q5]`,
            text: `(UFPB/2019-Adaptada) ...O Phishing √© um tipo de amea√ßa virtual... Em rela√ß√£o ao Phishing, assinale a alternativa correta.`,
            options: [ { text: `√â o termo usado para se referir aos e-mails n√£o solicitados...`, id: `A`, isCorrect: false }, { text: `S√£o programas especificamente desenvolvidos para executar a√ß√µes danosas...`, id: `B`, isCorrect: false }, { text: `√â um software projetado para monitorar as atividades de um sistema...`, id: `C`, isCorrect: false }, { text: `S√£o programas, ou parte de um programa de computador, normalmente maliciosos...`, id: `D`, isCorrect: false }, { text: `√â um m√©todo de envio de mensagens eletr√¥nicas que tentam se passar pela comunica√ß√£o oficial...`, id: `E`, isCorrect: true } ],
            gabaritoComentado: `Phishing usa mensagens falsas para obter informa√ß√µes confidenciais.`
        },
        {
            qIdPrefix: `bfq_`, stableId: `BFQ_GESTAO_RISCO_01_AV`, topicKey: 'GESTAO_RISCO_CRITICA',
            originalQNumberDisplay: `6`, highlight: true, sourceRef: `[Fonte: Prova AV.pdf, p. 5, Q6]`,
            text: `Assinale a op√ß√£o correta a respeito de seguran√ßa da informa√ß√£o, an√°lise de riscos e medidas de seguran√ßa f√≠sica e l√≥gica.`,
            options: [ { text: `Analisar riscos consiste em enumerar todos os tipos de risco...`, id: `A`, isCorrect: true }, { text: `Em an√°lises de riscos... desconsideram-se os poss√≠veis efeitos...`, id: `B`, isCorrect: false }, { text: `As medidas de seguran√ßa dividem-se em dois tipos: as preventivas e as corretivas.`, id: `C`, isCorrect: false }, { text: `Como medida de seguran√ßa corretiva utilizam-se firewalls e criptografia.`, id: `D`, isCorrect: false }, { text: `Como medida de seguran√ßa preventiva utilizam-se controle de acesso l√≥gico e sess√£o de autentica√ß√£o.`, id: `E`, isCorrect: false } ],
            gabaritoComentado: `A an√°lise de riscos completa envolve identificar riscos, consequ√™ncias e perdas.`
        },
        {
            qIdPrefix: `bfq_`, stableId: `BFQ_CONTROLES_01_ATIV`, topicKey: 'CONTROLES_SEGURANCA',
            originalQNumberDisplay: `7`, highlight: true, sourceRef: `[Fonte: ATIVIDADES PDF, p. 13, Q7 Simulados / simulados.pdf, p.9, Q3]`,
            text: `Redes de computadores conectadas √† internet s√£o alvos de invas√µes por parte de hackers. A ferramenta para permitir o acesso √† rede apenas por endere√ßos autorizados √©:`,
            options: [ { text: `Criptografia.`, id: `A`, isCorrect: false }, { text: `Firewall.`, id: `B`, isCorrect: true }, { text: `Certificado digital.`, id: `C`, isCorrect: false }, { text: `Antiv√≠rus.`, id: `D`, isCorrect: false }, { text: `Modem.`, id: `E`, isCorrect: false } ],
            gabaritoComentado: `Firewall controla o tr√°fego de rede baseado em regras, permitindo ou bloqueando acessos com base em endere√ßos e outras pol√≠ticas.`
        },
        {
            qIdPrefix: `bfq_`, stableId: `BFQ_GESTAO_RISCO_02_AV`, topicKey: 'GESTAO_RISCO_CRITICA',
            originalQNumberDisplay: `8`, highlight: true, sourceRef: `[Fonte: Prova AV.pdf, p. 6, Q8]`,
            text: `O risco residual √© assim classificado quando n√£o se tem uma resposta adequada ao risco, ou ele √© considerado m√≠nimo. Mesmo assim, deve passar pela etapa de:`,
            options: [ { text: `Comunica√ß√£o e consulta do risco.`, id: `A`, isCorrect: false }, { text: `Aceita√ß√£o do crivo.`, id: `B`, isCorrect: false }, { text: `Tratamento do risco.`, id: `C`, isCorrect: false }, { text: `Monitoramento e an√°lise cr√≠tica de riscos.`, id: `D`, isCorrect: true }, { text: `Marca√ß√£o do crit√©rio.`, id: `E`, isCorrect: false } ],
            gabaritoComentado: `Riscos residuais exigem monitoramento e an√°lise cr√≠tica cont√≠nuos.`
        }
    ];

    const randomizableQuestionPool = [
        { qIdPrefix: `rand_`, stableId: `RAND_CF_CID_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: simulados.pdf, p. 13, Q9]`, text: `A tr√≠ade CID √© uma forma simplificada de representar os m√∫ltiplos objetivos da seguran√ßa da informa√ß√£o. O que a triade CID, que o SGSI busca preservar, representa?`, options: [ { text: `Complac√™ncia, Integridade, Durabilidade.`, id: `A`, isCorrect: false }, { text: `Confidencialidade, Integridade, Disponibilidade.`, id: `B`, isCorrect: true }, { text: `Consist√™ncia, Implementa√ß√£o, Durabilidade.`, id: `C`, isCorrect: false }, { text: `Computa√ß√£o, Internet, Dados.`, id: `D`, isCorrect: false }, { text: `Certifica√ß√£o, Inova√ß√£o, Desenvolvimento.`, id: `E`, isCorrect: false } ], gabaritoComentado: `CID: Confidencialidade, Integridade e Disponibilidade.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CF_VULNERABILIDADE_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: Prova AV.pdf, p. 1, Q2 / simulados.pdf, p.4, Q6]`, text: `Na seguran√ßa da informa√ß√£o, a fragilidade de um ativo ou grupo de ativos, que pode ser explorada por uma ou mais amea√ßas, √© chamada de:`, options: [ { text: `Risco.`, id: `A`, isCorrect: false }, { text: `Incidente de seguran√ßa da informa√ß√£o.`, id: `B`, isCorrect: false }, { text: `Amea√ßa.`, id: `C`, isCorrect: false }, { text: `Vulnerabilidade.`, id: `D`, isCorrect: true }, { text: `Desastre.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Vulnerabilidade √© a fragilidade de um ativo que pode ser explorada por amea√ßas.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CF_CONFIDENCIALIDADE_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: PRATICANDO.pdf, p. 8, Desafio 1 / simulados.pdf, p.3, Q5]`, text: `Qual caracter√≠stica da seguran√ßa da informa√ß√£o voc√™ deve priorizar para garantir que informa√ß√µes confidenciais sejam acessadas apenas por quem tem autoriza√ß√£o?`, options: [ { text: `Disponibilidade.`, id: `A`, isCorrect: false }, { text: `Integridade.`, id: `B`, isCorrect: false }, { text: `N√£o Rep√∫dio.`, id: `C`, isCorrect: false }, { text: `Autenticidade.`, id: `D`, isCorrect: false }, { text: `Confidencialidade.`, id: `E`, isCorrect: true } ], gabaritoComentado: `A confidencialidade √© o princ√≠pio que assegura que a informa√ß√£o seja acessada apenas por pessoas autorizadas.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CF_AUTENTICIDADE_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: PRATICANDO.pdf, p. 11, Desafio 3]`, text: `Considerando a necessidade de verificar se os sistemas garantem que todas as informa√ß√µes s√£o manipuladas por pessoas ou sistemas que possam ser confirmados como leg√≠timos, o que √© garantido pelo princ√≠pio da autenticidade na seguran√ßa da informa√ß√£o?`, options: [ { text: `Garante que apenas pessoas autorizadas ter√£o acesso √† informa√ß√£o.`, id: `A`, isCorrect: false }, { text: `Garante um tratamento igual entre todas as pessoas.`, id: `B`, isCorrect: false }, { text: `Garante que apenas pessoas autorizadas poder√£o alterar a informa√ß√£o.`, id: `C`, isCorrect: false }, { text: `Garante que a informa√ß√£o estar√° dispon√≠vel sempre que um usu√°rio autorizado quiser acess√°-la.`, id: `D`, isCorrect: false }, { text: `Garante a veracidade da autoria da informa√ß√£o, al√©m do n√£o rep√∫dio.`, id: `E`, isCorrect: true } ], gabaritoComentado: `O princ√≠pio da autenticidade assegura que as informa√ß√µes sejam genu√≠nas e que a autoria ou fonte possa ser verificada e confirmada, incluindo o n√£o rep√∫dio.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CF_VULN_ENTRE_AMEACAS_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: Prova AV.pdf, p. 2, Q3]`, text: `(CESGRANRIO/2014) Durante um processo de identifica√ß√£o de amea√ßas e vulnerabilidades, um analista deveria gerar uma lista de amea√ßas, mas cometeu um engano e incluiu entre elas uma vulnerabilidade. Qual √© a vulnerabilidade listada entre as amea√ßas?`, options: [ { text: `Hacker.`, id: `A`, isCorrect: false }, { text: `V√≠rus.`, id: `B`, isCorrect: false }, { text: `Porta TCP aberta.`, id: `C`, isCorrect: true }, { text: `Funcion√°rio descontente.`, id: `D`, isCorrect: false }, { text: `Instabilidade de energia.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Porta TCP aberta √© uma fragilidade (vulnerabilidade) que pode ser explorada. As outras op√ß√µes s√£o amea√ßas (agentes ou eventos).` },
        { qIdPrefix: `rand_`, stableId: `RAND_CF_AUTENTICACAO_DEF_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: simulados.pdf, p. 8, Q1]`, text: `O crescimento das redes abertas (...) surgiu a necessidade de verifica√ß√£o da identidade tanto dos usu√°rios quanto dos sistemas e processos. Dentro desse contexto, esse ato de verifica√ß√£o √© chamado:`, options: [ { text: `Configura√ß√£o.`, id: `A`, isCorrect: false }, { text: `Acessibilidade.`, id: `B`, isCorrect: false }, { text: `Autentica√ß√£o.`, id: `C`, isCorrect: true }, { text: `Confiabilidade.`, id: `D`, isCorrect: false }, { text: `Cadastro.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Autentica√ß√£o √© o processo de verificar a identidade de um usu√°rio, sistema ou processo.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CF_CONFIDENCIALIDADE_LAPTOPS_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: simulados.pdf, p. 8, Q2]`, text: `Qual problema de seguran√ßa √© destacado nos exemplos de laptops levados para manuten√ß√£o e discos r√≠gidos de segunda m√£o comprados na Internet, como por exemplo, no eBay?`, options: [ { text: `Falha na integridade dos dados.`, id: `A`, isCorrect: false }, { text: `Problemas na disponibilidade da informa√ß√£o.`, id: `B`, isCorrect: false }, { text: `Falhas na confidencialidade dos dados.`, id: `C`, isCorrect: true }, { text: `Aus√™ncia de autenticidade dos dados.`, id: `D`, isCorrect: false }, { text: `Viola√ß√µes de n√£o rep√∫dio.`, id: `E`, isCorrect: false } ], gabaritoComentado: `A exposi√ß√£o de dados em laptops ou discos r√≠gidos descartados/vendidos representa uma falha na confidencialidade.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CF_CONCEITOS_AMEACA_RISCO_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: simulados.pdf, p. 11, Q6]`, text: `Sobre os conceitos de seguran√ßa da informa√ß√£o, analise as afirmativas a seguir:<br>I. Uma amea√ßa tem o poder de comprometer ativos vulner√°veis.<br>II. Risco √© a combina√ß√£o das consequ√™ncias de um incidente de seguran√ßa com a sua probabilidade de ocorr√™ncia.<br>III. Vulnerabilidades t√©cnicas s√£o mais cr√≠ticas do que vulnerabilidades criadas por comportamento humano.<br>Est√° correto somente o que se afirma em:`, options: [ { text: `I`, id: `A`, isCorrect: false }, { text: `II`, id: `B`, isCorrect: false }, { text: `III`, id: `C`, isCorrect: false }, { text: `I e II`, id: `D`, isCorrect: true }, { text: `I e III`, id: `E`, isCorrect: false } ], gabaritoComentado: `I e II est√£o corretas. III √© incorreta pois vulnerabilidades humanas s√£o frequentemente consideradas muito cr√≠ticas.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CF_ATIVO_LOGICO_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: simulados.pdf, p. 12, Q7]`, text: `De maneira geral, qual exemplo pode ser considerado um ativo l√≥gico? (Considerando o contexto de SI, onde 'l√≥gico' se op√µe a 'f√≠sico')`, options: [ { text: `Informa√ß√£o.`, id: `A`, isCorrect: true }, { text: `Servidor (Hardware).`, id: `B`, isCorrect: false }, { text: `Colaboradores.`, id: `C`, isCorrect: false }, { text: `Edif√≠cio.`, id: `D`, isCorrect: false }, { text: `Imagem da organiza√ß√£o.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Informa√ß√£o √© um ativo l√≥gico prim√°rio em Seguran√ßa da Informa√ß√£o. Hardware √© f√≠sico. Imagem e Colaboradores s√£o outros tipos de ativos.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CF_RISCO_AMEACA_VULN_CONTEXTO_01`, topicKey: 'CONCEITOS_FUNDAMENTAIS', sourceRef: `[Fonte: PRATICANDO.pdf, p.3 Estudo de Caso]`, text: `No estudo de caso da TechSecure, hackers exploraram 'vulnerabilidades no sistema de gerenciamento de senhas e nos controles de acesso'. A tentativa de invas√£o em si representa uma:`, options: [ { text: `Vulnerabilidade`, id: `A`, isCorrect: false }, { text: `Amea√ßa (concretizada)`, id: `B`, isCorrect: true }, { text: `Controle`, id: `C`, isCorrect: false }, { text: `Ativo`, id: `D`, isCorrect: false }, { text: `Risco (materializado)`, id: `E`, isCorrect: false } ], gabaritoComentado: `A tentativa de invas√£o √© a a√ß√£o da amea√ßa (hackers). A vulnerabilidade √© a falha que permitiu. O risco √© a combina√ß√£o da probabilidade dessa amea√ßa explorar a vulnerabilidade e o impacto resultante.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CS_FIREWALL_POL_01`, topicKey: 'CONTROLES_SEGURANCA', sourceRef: `[Fonte: PRATICANDO.pdf, p. 5, Desafio 2]`, text: `Considerando as melhores pr√°ticas de seguran√ßa, qual √© a politica mais comumente recomendada para configurar as regras de firewall e garantir que a rede esteja adequadamente protegida contra acessos n√£o autorizados?`, options: [ { text: `Aceitar todos por padr√£o, negar alguns.`, id: `A`, isCorrect: false }, { text: `Negar por padr√£o, autorizar explicitamente.`, id: `B`, isCorrect: true }, { text: `Aceitar por padr√£o, negar por exce√ß√£o.`, id: `C`, isCorrect: false }, { text: `Autorizar todos por padr√£o, restringir alguns.`, id: `D`, isCorrect: false }, { text: `Negar todos por padr√£o, sem exce√ß√µes.`, id: `E`, isCorrect: false } ], gabaritoComentado: `A pr√°tica mais recomendada √© configurar o firewall para negar todo o tr√°fego por padr√£o e autorizar explicitamente apenas o que √© necess√°rio (deny by default).` },
        { qIdPrefix: `rand_`, stableId: `RAND_CS_HASH_01`, topicKey: 'CONTROLES_SEGURANCA', sourceRef: `[Fonte: simulados.pdf, p. 2, Q3]`, text: `Complete a frase corretamente: "as fun√ß√µes de hash, por exemplo, s√£o adequadas para garantir a integridade dos dados, porque ..."`, options: [ { text: `Qualquer altera√ß√£o feita no conte√∫do de uma mensagem far√° com que o receptor calcule um valor de hash diferente daquele colocado na transmiss√£o pelo remetente.`, id: `A`, isCorrect: true }, { text: `Geralmente podem ser calculadas muito mais r√°pido que os valores de criptografia de chave p√∫blica.`, id: `B`, isCorrect: false }, { text: `Usam chave √∫nica para criptografar e descriptografar a mensagem.`, id: `C`, isCorrect: false }, { text: `Fazem a troca de chaves na chave sim√©trica.`, id: `D`, isCorrect: false }, { text: `Utilizam algoritmos de criptografia de chave p√∫blica.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Fun√ß√µes de hash garantem a integridade, pois qualquer altera√ß√£o na mensagem original resulta em um hash diferente.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CS_SEGURANCAFISICA_01`, topicKey: 'CONTROLES_SEGURANCA', sourceRef: `[Fonte: PRATICANDO.pdf, p. 4, Desafio 1]`, text: `Com base nas melhores pr√°ticas de seguran√ßa, qual das seguintes op√ß√µes seria mais adequada para ser utilizada como a primeira linha de defesa ao se aproximar das instala√ß√µes da empresa?`, options: [ { text: `Firewalls.`, id: `A`, isCorrect: false }, { text: `Criptografia.`, id: `B`, isCorrect: false }, { text: `Catra√ßas e elevadores.`, id: `C`, isCorrect: false }, { text: `Cancelas com seguran√ßas verificando identifica√ß√µes.`, id: `D`, isCorrect: true }, { text: `Sistemas de detec√ß√£o de intrus√£o.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Cancelas com seguran√ßas verificando identifica√ß√µes representam a primeira linha de defesa f√≠sica ao se aproximar de uma instala√ß√£o.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CS_ANTIVIRUS_01`, topicKey: 'CONTROLES_SEGURANCA', sourceRef: `[Fonte: simulados.pdf, p. 3, Q4]`, text: `(AMEOSC/2022 Adaptada) Protege o computador contra outros programas potencialmente danosos. Ele detecta, impede e atua na remo√ß√£o de programas maliciosos, como v√≠rus e worms. Marque a alternativa CORRETA que corresponde ao contexto acima.`, options: [ { text: `Proxy.`, id: `A`, isCorrect: false }, { text: `Antiv√≠rus.`, id: `B`, isCorrect: true }, { text: `Firewall.`, id: `C`, isCorrect: false }, { text: `Painel de Controle.`, id: `D`, isCorrect: false }, { text: `Roteador.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Antiv√≠rus √© o software que detecta, impede e remove programas maliciosos.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CS_CRYPTO_CHAVES_01`, topicKey: 'CONTROLES_SEGURANCA', sourceRef: `[Fonte: PRATICANDO.pdf, p. 6-7, Desafio 3]`, text: `Considerando $R^+$ e $R^-$ as chaves p√∫blica e privada do remetente, e $D^+$ e $D^-$ as chaves p√∫blica e privada do destinat√°rio, para garantir a confidencialidade de uma mensagem, o remetente deve usar ______ para criptografar, e o destinat√°rio usar√° ______ para decriptar.`, options: [ { text: `$R^+$, $R^-$`, id: `A`, isCorrect: false }, { text: `$D^+$, $D^-$`, id: `B`, isCorrect: true }, { text: `$R^-$, $R^+$`, id: `C`, isCorrect: false }, { text: `$D^-$, $D^+$`, id: `D`, isCorrect: false }, { text: `$R^+$, $D^-$`, id: `E`, isCorrect: false } ], gabaritoComentado: `Para confidencialidade, a mensagem √© criptografada com a chave p√∫blica do destinat√°rio ($D^+$) e decriptada com a chave privada do destinat√°rio ($D^-$).` },
        { qIdPrefix: `rand_`, stableId: `RAND_CS_BACKUP_IMPORTANCE_01`, topicKey: 'CONTROLES_SEGURANCA', sourceRef: `[Fonte: PRATICANDO.pdf, p. 18, Desafio 2 / simulados.pdf, p.1, Q1]`, text: `Qual das op√ß√µes a seguir melhor justifica a necessidade de backups regulares como medida de seguran√ßa?`, options: [ { text: `Backup √© um desperd√≠cio de tempo e recursos...`, id: `A`, isCorrect: false }, { text: `Realizar backups permite que voc√™ se livre de dados antigos...`, id: `B`, isCorrect: false }, { text: `Caso as informa√ß√µes sejam perdidas ou corrompidas..., um backup recente pode ser restaurado, garantindo a continuidade das opera√ß√µes.`, id: `C`, isCorrect: true }, { text: `Os backups s√£o importantes apenas para grandes empresas...`, id: `D`, isCorrect: false }, { text: `Os backups s√£o √∫teis apenas para fins de auditoria...`, id: `E`, isCorrect: false } ], gabaritoComentado: `Backups regulares s√£o essenciais para restaurar dados em caso de falhas, malware ou erros humanos, garantindo a continuidade das opera√ß√µes.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CS_PROTECAO_EQUIPAMENTO_01`, topicKey: 'CONTROLES_SEGURANCA', sourceRef: `[Fonte: Prova AV.pdf, p. 2, Q4]`, text: `Um funcion√°rio esbarrou em um servidor web que estava no canto de uma mesa e o derrubou, parando a opera√ß√£o do mesmo. Segundo a norma ABNT NBR ISO/IEC 27002:2013, o respons√°vel pela seguran√ßa do servidor deixou de colocar em pr√°tica o controle relacionado √†:`, options: [ { text: `Segrega√ß√£o de fun√ß√µes.`, id: `A`, isCorrect: false }, { text: `Invent√°rio dos ativos.`, id: `B`, isCorrect: false }, { text: `Acordo de confidencialidade.`, id: `C`, isCorrect: false }, { text: `Localiza√ß√£o e prote√ß√£o do equipamento.`, id: `D`, isCorrect: true }, { text: `Gerenciamento de senha de usu√°rio.`, id: `E`, isCorrect: false } ], gabaritoComentado: `A norma ISO/IEC 27002 aborda a import√¢ncia da localiza√ß√£o e prote√ß√£o f√≠sica dos equipamentos para prevenir danos, acessos n√£o autorizados ou interrup√ß√µes.` },
        { qIdPrefix: `rand_`, stableId: `RAND_CS_BOAS_PRATICAS_SENHA_01`, topicKey: 'CONTROLES_SEGURANCA', sourceRef: `[Fonte: simulados.pdf, p. 2, Q2]`, text: `Qual das op√ß√µes abaixo √© considerada uma boa pr√°tica de seguran√ßa referente a senhas?`, options: [ { text: `Nunca compartilhar senhas.`, id: `A`, isCorrect: true }, { text: `Usar a mesma senha para m√∫ltiplos servi√ßos para facilitar a memoriza√ß√£o.`, id: `B`, isCorrect: false }, { text: `Anotar senhas em post-its colados no monitor.`, id: `C`, isCorrect: false }, { text: `Escolher senhas curtas e f√°ceis de adivinhar, como "123456".`, id: `D`, isCorrect: false }, { text: `Desabilitar a autentica√ß√£o multifator sempre que poss√≠vel.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Nunca compartilhar senhas √© uma boa pr√°tica fundamental de seguran√ßa da informa√ß√£o. As outras op√ß√µes representam pr√°ticas inseguras.` },
        { qIdPrefix: `rand_`, stableId: `RAND_AE_MALWARE_BOTS_01`, topicKey: 'AMEACAS_ESPECIFICAS', sourceRef: `[Fonte: ATIVIDADES PDF, p. 1, Q2]`, text: `(FCC/2012- Adaptada) C√≥digos maliciosos (malwares) s√£o programas desenvolvidos para executar a√ß√µes danosas. Sobre bots e botnets, √© correto afirmar:`, options: [ { text: `Botnet √© um software malicioso de monitoramento individual de teclado.`, id: `A`, isCorrect: false }, { text: `Bot √© um programa que depende da a√ß√£o do usu√°rio para se replicar.`, id: `B`, isCorrect: false }, { text: `Um computador infectado por um bot √© chamado de 'servidor mestre'.`, id: `C`, isCorrect: false }, { text: `A comunica√ß√£o entre o invasor e o computador infectado (zumbi) ocorre exclusivamente via HTTP.`, id: `D`, isCorrect: false }, { text: `Algumas das a√ß√µes maliciosas executadas por botnets s√£o: ataques de nega√ß√£o de servi√ßo (DoS/DDoS), envio de spam e furto de dados.`, id: `E`, isCorrect: true } ], gabaritoComentado: `Botnets s√£o redes de computadores infectados (zumbis) controlados por um invasor para realizar ataques em massa, como DoS/DDoS.` },
        { qIdPrefix: `rand_`, stableId: `RAND_AE_RANSOMWARE_01`, topicKey: 'AMEACAS_ESPECIFICAS', sourceRef: `[Fonte: ATIVIDADES PDF, p. 2, Q3]`, text: `√â um tipo de malware feito para extorquir dinheiro da v√≠tima, geralmente criptografando seus arquivos e exigindo um resgate para liber√°-los. O texto se refere ao:`, options: [ { text: `Spyware`, id: `A`, isCorrect: false },{ text: `Botnet`, id: `B`, isCorrect: false }, { text: `Spam`, id: `C`, isCorrect: false },{ text: `DDOS`, id: `D`, isCorrect: false }, { text: `Ransomware`, id: `E`, isCorrect: true } ], gabaritoComentado: `O enunciado descreve o Ransomware, que sequestra dados e exige resgate.` },
        { qIdPrefix: `rand_`, stableId: `RAND_AE_ENGSOCIAL_RISCO_01`, topicKey: 'AMEACAS_ESPECIFICAS', sourceRef: `[Fonte: PRATICANDO.pdf, p. 9, Desafio 2]`, text: `Considerando o contexto de fraudes digitais que exploram falhas humanas, qual √© o principal risco associado ao uso de t√©cnicas de engenharia social?`, options: [ { text: `C√≥digos maliciosos nos computadores.`, id: `A`, isCorrect: false }, { text: `Criptoan√°lises de senhas.`, id: `B`, isCorrect: false }, { text: `Boatos espalhados pela internet.`, id: `C`, isCorrect: false }, { text: `Fraudes contra os usu√°rios.`, id: `D`, isCorrect: true }, { text: `Quebras de privacidade dos usu√°rios.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Engenharia social √© amplamente utilizada para enganar e manipular usu√°rios, levando-os a realizar a√ß√µes que resultam em fraudes.` },
        { qIdPrefix: `rand_`, stableId: `RAND_AE_VIRUS_BLINDADO_01`, topicKey: 'AMEACAS_ESPECIFICAS', sourceRef: `[Fonte: PRATICANDO.pdf, p. 17, Desafio 1 / Prova AV.pdf, p.6, Q9]`, text: `Um v√≠rus estava tentando evitar a detec√ß√£o, fazendo com que o antiv√≠rus acreditasse que o programa malicioso estava em uma localiza√ß√£o diferente da real. Qual tipo de v√≠rus possui essa habilidade?`, options: [ { text: `V√≠rus blindado.`, id: `A`, isCorrect: true }, { text: `V√≠rus stealth.`, id: `B`, isCorrect: false }, { text: `Polim√≥rfico.`, id: `C`, isCorrect: false }, { text: `Mutante.`, id: `D`, isCorrect: false }, { text: `Cavalo de Troia.`, id: `E`, isCorrect: false } ], gabaritoComentado: `O v√≠rus blindado √© projetado para dificultar a an√°lise, enganando o antiv√≠rus sobre sua localiza√ß√£o real.` },
        { qIdPrefix: `rand_`, stableId: `RAND_AE_PHISHING_DEFINE_01`, topicKey: 'AMEACAS_ESPECIFICAS', sourceRef: `[Fonte: PRATICANDO.pdf, p. 20, Desafio 3]`, text: `Qual das alternativas abaixo define corretamente o phishing?`, options: [ { text: `√â o termo usado para se referir aos e-mails n√£o solicitados...`, id: `A`, isCorrect: false }, { text: `S√£o programas especificamente desenvolvidos para executar a√ß√µes danosas...`, id: `B`, isCorrect: false }, { text: `√â um software projetado para monitorar as atividades de um sistema...`, id: `C`, isCorrect: false }, { text: `S√£o programas, ou parte de um programa de computador, normalmente maliciosos...`, id: `D`, isCorrect: false }, { text: `√â um m√©todo de envio de mensagens eletr√¥nicas que tentam se passar pela comunica√ß√£o oficial de uma institui√ß√£o conhecida...`, id: `E`, isCorrect: true } ], gabaritoComentado: `Phishing √© um m√©todo de envio de mensagens eletr√¥nicas fraudulentas que se passam por comunica√ß√µes oficiais para roubar informa√ß√µes sens√≠veis.` },
        { qIdPrefix: `rand_`, stableId: `RAND_NS_ISO27001_OBJ_01`, topicKey: 'NORMAS_SEGURANCA', sourceRef: `[Fonte: Prova AV.pdf, p. 5, Q7 / PRATICANDO.pdf, p.12, Desafio 1]`, text: `Qual norma t√©cnica possui o seguinte t√≠tulo: "Tecnologia da informa√ß√£o - T√©cnicas de seguran√ßa - Sistemas de gest√£o da seguran√ßa da informa√ß√£o - Requisitos"?`, options: [ { text: `ABNT NBR ISO/IEC 27001:2013`, id: `A`, isCorrect: true }, { text: `ABNT NBR ISO/IEC 27002:2013`, id: `B`, isCorrect: false }, { text: `ABNT NBR ISO/IEC 20000-1:2011`, id: `C`, isCorrect: false }, { text: `ABNT NBR ISO 9001:2008`, id: `D`, isCorrect: false }, { text: `ABNT NBR ISO 14001:2004`, id: `E`, isCorrect: false } ], gabaritoComentado: `A norma ABNT NBR ISO/IEC 27001:2013 estabelece os requisitos para um Sistema de Gest√£o de Seguran√ßa da Informa√ß√£o (SGSI).` },
        { qIdPrefix: `rand_`, stableId: `RAND_NS_ISO27001_BENEFIT_01`, topicKey: 'NORMAS_SEGURANCA', sourceRef: `[Fonte: PRATICANDO.pdf, p. 14, Desafio 2]`, text: `Qual das op√ß√µes abaixo representa um dos principais benef√≠cios da ado√ß√£o da norma ISO/IEC 27001:2013?`, options: [ { text: `Oportunidade de identificar e eliminar fraquezas`, id: `A`, isCorrect: true }, { text: `Mecanismo para eliminar o sucesso do sistema`, id: `B`, isCorrect: false }, { text: `N√£o participa√ß√£o da ger√™ncia na seguran√ßa da informa√ß√£o`, id: `C`, isCorrect: false }, { text: `Fornece inseguran√ßa a todas as partes interessadas`, id: `D`, isCorrect: false }, { text: `Isola recursos com outros sistemas de gerenciamento`, id: `E`, isCorrect: false } ], gabaritoComentado: `A ado√ß√£o da ISO/IEC 27001:2013 permite que uma organiza√ß√£o identifique fraquezas e vulnerabilidades, sendo fundamental para melhorias cont√≠nuas.` },
        { qIdPrefix: `rand_`, stableId: `RAND_NS_ISO_SURVEY_01`, topicKey: 'NORMAS_SEGURANCA', sourceRef: `[Fonte: PRATICANDO.pdf, p. 15, Desafio 3 / simulados.pdf, p.12, Q8]`, text: `Qual das op√ß√µes abaixo melhor define o "The ISO Survey of Certifications"?`, options: [ { text: `Um site onde as organiza√ß√µes podem obter certifica√ß√µes ISO`, id: `A`, isCorrect: false }, { text: `Uma revista anual sobre as atualiza√ß√µes das normas ISO`, id: `B`, isCorrect: false }, { text: `Uma pesquisa anual sobre o n√∫mero de certificados v√°lidos para os padr√µes do sistema de gerenciamento ISO em todo o mundo`, id: `C`, isCorrect: true }, { text: `Uma confer√™ncia onde s√£o discutidos os padr√µes ISO`, id: `D`, isCorrect: false }, { text: `Uma organiza√ß√£o que define as normas ISO`, id: `E`, isCorrect: false } ], gabaritoComentado: `O "The ISO Survey of Certifications" √© uma pesquisa anual da ISO que coleta dados sobre o n√∫mero de certificados v√°lidos emitidos para as normas de sistemas de gest√£o ISO.` },
        { qIdPrefix: `rand_`, stableId: `RAND_NS_PROCEDIMENTO_SEGURANCA_ORG_01`, topicKey: 'NORMAS_SEGURANCA', sourceRef: `[Fonte: simulados.pdf, p. 9-10, Q4]`, text: `Assinale a alternativa que apresenta procedimento de seguran√ßa da informa√ß√£o que pode ser adotado pelas organiza√ß√µes, alinhado com boas pr√°ticas e normativas.`, options: [ { text: `Realizar, periodicamente, an√°lises de riscos, com o objetivo de contemplar as mudan√ßas nos requisitos de seguran√ßa da informa√ß√£o`, id: `A`, isCorrect: true }, { text: `N√£o envolver a dire√ß√£o com a seguran√ßa da informa√ß√£o, delegando totalmente a responsabilidade ao TI.`, id: `B`, isCorrect: false }, { text: `Descartar o invent√°rio dos ativos para simplificar a gest√£o.`, id: `C`, isCorrect: false }, { text: `Evitar treinamentos em seguran√ßa da informa√ß√£o para n√£o alarmar os funcion√°rios.`, id: `D`, isCorrect: false }, { text: `Conceder aos funcion√°rios o acesso completo a todos os sistemas e √† rede (intranet) da organiza√ß√£o para maior agilidade.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Realizar an√°lises de riscos periodicamente √© um procedimento fundamental de seguran√ßa da informa√ß√£o, preconizado por normas como a ISO 27001.` },
        { qIdPrefix: `rand_`, stableId: `RAND_NS_ISO27001_NAO_BENEFICIO_01`, topicKey: 'NORMAS_SEGURANCA', sourceRef: `[Fonte: simulados.pdf, p. 13, Q10]`, text: `Assinale a assertiva que N√ÉO representa um dos benef√≠cios para a ado√ß√£o da norma ABNT NBR ISO/IEC 27001:2013 por uma organiza√ß√£o:`, options: [ { text: `Oportunidade de identificar e eliminar fraquezas`, id: `A`, isCorrect: false }, { text: `Mecanismo para minimizar o fracasso do sistema de gest√£o de seguran√ßa`, id: `B`, isCorrect: false }, { text: `Participa√ß√£o e comprometimento da ger√™ncia na Seguran√ßa da Informa√ß√£o`, id: `C`, isCorrect: false }, { text: `Fornece seguran√ßa e confian√ßa a todas as partes interessadas`, id: `D`, isCorrect: false }, { text: `Isola recursos de seguran√ßa com outros sistemas de gerenciamento da organiza√ß√£o`, id: `E`, isCorrect: true } ], gabaritoComentado: `A ISO 27001 √© projetada para ser integrada com outros sistemas de gest√£o (como ISO 9001, etc.), n√£o para isolar recursos. As outras op√ß√µes s√£o benef√≠cios ou aspectos positivos.` },
        { qIdPrefix: `rand_`, stableId: `RAND_NS_ESTUDO_CASO_ISO_01`, topicKey: 'NORMAS_CRITICAS', highlight: true, sourceRef: `[Fonte: PRATICANDO.pdf, p.3 Estudo de Caso]`, text: `No caso da TechSecure, que adota parcialmente as normas ISO/IEC 27001 e 27002, qual a principal recomenda√ß√£o para corrigir as vulnerabilidades e garantir a conformidade total?`, options: [ { text: `Aumentar apenas o investimento em antiv√≠rus.`, id: `A`, isCorrect: false }, { text: `Realizar uma auditoria completa dos sistemas de seguran√ßa para identificar e corrigir lacunas na implementa√ß√£o das normas ISO...`, id: `B`, isCorrect: true }, { text: `Demitir a equipe de TI do fim de semana.`, id: `C`, isCorrect: false }, { text: `Migrar todos os dados para a nuvem sem uma an√°lise pr√©via.`, id: `D`, isCorrect: false }, { text: `Ignorar as normas ISO e focar apenas em firewalls.`, id: `E`, isCorrect: false } ], gabaritoComentado: `A chave de resposta indica a necessidade de uma auditoria completa das normas ISO.` },
        { qIdPrefix: `rand_`, stableId: `RAND_GR_AVALIACAO_RISCOS_01`, topicKey: 'GESTAO_RISCO', sourceRef: `[Fonte: simulados.pdf, p. 5, Q7]`, text: `Um funcion√°rio... concluiu que existe uma probabilidade de 67% de sobrecarga... Dentro da Gest√£o de Riscos (GR), essa conclus√£o pode ser obtida na etapa de:`, options: [ { text: `Defini√ß√£o do contexto.`, id: `A`, isCorrect: false }, { text: `Monitoramento e controle de riscos.`, id: `B`, isCorrect: false }, { text: `Processo de avalia√ß√£o de riscos (An√°lise de Riscos).`, id: `C`, isCorrect: true }, { text: `Tratamento de riscos.`, id: `D`, isCorrect: false }, { text: `Aceita√ß√£o do risco (residual).`, id: `E`, isCorrect: false } ], gabaritoComentado: `A identifica√ß√£o da probabilidade e impacto faz parte da avalia√ß√£o/an√°lise de riscos.` },
        { qIdPrefix: `rand_`, stableId: `RAND_GR_RISCO_DEFINICAO_01`, topicKey: 'GESTAO_RISCO', sourceRef: `[Fonte: simulados.pdf, p. 6, Q10]`, text: `A respeito do conceito de Risco em Seguran√ßa da Informa√ß√£o, selecione a op√ß√£o correta:`, options: [ { text: `√â o efeito da incerteza nos objetivos, podendo ser positivo ou negativo.`, id: `A`, isCorrect: true }, { text: `Um evento s√∫bito e imprevisto que provoca grandes perdas...`, id: `B`, isCorrect: false }, { text: `Algo que sempre pode ser totalmente eliminado...`, id: `C`, isCorrect: false }, { text: `Refere-se exclusivamente a amea√ßas externas...`, id: `D`, isCorrect: false }, { text: `√â um sin√¥nimo direto de vulnerabilidade.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Risco √© o efeito da incerteza nos objetivos.` },
        { qIdPrefix: `rand_`, stableId: `RAND_GR_LINK_INSTAVEL_SLA_01`, topicKey: 'GESTAO_RISCO', sourceRef: `[Fonte: simulados.pdf, p. 10, Q5]`, text: `O link de acesso √† internet de uma institui√ß√£o encontra-se muito inst√°vel porque o seu provedor n√£o cumpre o SLA... Do ponto de vista de seguran√ßa e an√°lise de risco, isso deve ser considerado como evid√™ncia de:`, options: [ { text: `BYOD.`, id: `A`, isCorrect: false }, { text: `Amea√ßa.`, id: `B`, isCorrect: false }, { text: `Nega√ß√£o de servi√ßo.`, id: `C`, isCorrect: false }, { text: `Vulnerabilidade.`, id: `D`, isCorrect: true }, { text: `Incidente.`, id: `E`, isCorrect: false } ], gabaritoComentado: `A depend√™ncia de um provedor inst√°vel √© uma vulnerabilidade.` },
        { qIdPrefix: `rand_`, stableId: `RAND_GR_RISCOS_RESIDUAIS_01`, topicKey: 'GESTAO_RISCO', sourceRef: `[Fonte: PRATICANDO.pdf, p. 23, Desafio 2]`, text: `O que s√£o riscos residuais na gest√£o de riscos de seguran√ßa da informa√ß√£o?`, options: [ { text: `Riscos que n√£o podem ser tratados.`, id: `A`, isCorrect: false }, { text: `Riscos que foram aceitos pela organiza√ß√£o.`, id: `B`, isCorrect: true }, { text: `Riscos que foram totalmente eliminados.`, id: `C`, isCorrect: false }, { text: `Riscos que n√£o foram identificados.`, id: `D`, isCorrect: false }, { text: `Riscos que foram transferidos para terceiros.`, id: `E`, isCorrect: false } ], gabaritoComentado: `Riscos residuais s√£o aqueles que permanecem ap√≥s o tratamento e s√£o aceitos.` },
        { qIdPrefix: `rand_`, stableId: `RAND_GCN_PGCN_OBJETIVO_01`, topicKey: 'GESTAO_CONTINUIDADE', sourceRef: `[Fonte: PRATICANDO.pdf, p. 27, Desafio 2 / simulados.pdf, p.5, Q8]`, text: `Com base na norma NBR15999-1 (2007), qual √© o principal objetivo da Pol√≠tica de Gest√£o de Continuidade de Neg√≥cios (PGCN)?`, options: [ { text: `Melhorar a efici√™ncia dos processos...`, id: `A`, isCorrect: false }, { text: `Atender a regulamenta√ß√µes de seguran√ßa cibern√©tica.`, id: `B`, isCorrect: false }, { text: `Fornecer uma base para entender, desenvolver e implementar a continuidade de neg√≥cios...`, id: `C`, isCorrect: true },  { text: `Implementar pr√°ticas de gerenciamento de projetos.`, id: `D`, isCorrect: false }, { text: `Criar planos de marketing para a organiza√ß√£o.`, id: `E`, isCorrect: false } ], gabaritoComentado: `PGCN visa fornecer base para entender, desenvolver e implementar a continuidade de neg√≥cios.` },
        { qIdPrefix: `rand_`, stableId: `RAND_GCN_PDCA_MELHORIA_01`, topicKey: 'GESTAO_CONTINUIDADE', sourceRef: `[Fonte: PRATICANDO.pdf, p. 26, Desafio 1]`, text: `No contexto do ciclo PDCA (Planejar, Fazer, Checar, Agir) utilizado para um Plano de Continuidade de Neg√≥cios (PCN), qual das etapas √© respons√°vel por promover a melhoria cont√≠nua do plano?`, options: [ { text: `P - Planejar.`, id: `A`, isCorrect: false }, { text: `D- Executar.`, id: `B`, isCorrect: false }, { text: `C - Checar.`, id: `C`, isCorrect: false }, { text: `A - Agir.`, id: `D`, isCorrect: true }, { text: `O PDCA n√£o √© adequado para o PCN.`, id: `E`, isCorrect: false } ], gabaritoComentado: `A fase "Agir" (Act) do PDCA √© respons√°vel pela melhoria cont√≠nua.` },
        { qIdPrefix: `rand_`, stableId: `RAND_GCN_PCN_INSTRUMENTO_PDCA_01`, topicKey: 'GESTAO_CONTINUIDADE', sourceRef: `[Fonte: simulados.pdf, p. 6, Q9 / PRATICANDO.pdf, p.29, Desafio 3]`, text: `Marque a alternativa que indica o instrumento/metodologia mais utilizado para a implementa√ß√£o e melhoria cont√≠nua do PCN (Planejamento de Continuidade de Neg√≥cios).`, options: [ { text: `SWOT`, id: `A`, isCorrect: false }, { text: `BSC`, id: `B`, isCorrect: false }, { text: `PDCA`, id: `C`, isCorrect: true }, { text: `ROI`, id: `D`, isCorrect: false }, { text: `CRM`, id: `E`, isCorrect: false } ], gabaritoComentado: `O PDCA √© amplamente utilizado para implementa√ß√£o e melhoria de PCN.` },
        { qIdPrefix: `rand_`, stableId: `RAND_GCN_AV_PCN_PDCA_ETAPA_IMPL_01`, topicKey: 'GESTAO_CONTINUIDADE', sourceRef: `[Fonte: Prova AV.pdf, p. 7, Q10]`, text: `Em rela√ß√£o ao ciclo b√°sico de atividades recomendado pela NBR 15999 para a realiza√ß√£o de um bom Plano de Continuidade de Neg√≥cios (PCN)...selecione a etapa na qual ser√£o implementadas as estrat√©gias...:`, options: [ { text: `Mapeamento de Neg√≥cios.`, id: `A`, isCorrect: false }, { text: `An√°lise de Impacto de Neg√≥cios.`, id: `B`, isCorrect: false }, { text: `Defini√ß√£o de Melhores Estrat√©gias.`, id: `C`, isCorrect: false }, { text: `Desenvolvimento e Implementa√ß√£o da Resposta de GCN (Fazer/Executar).`, id: `D`, isCorrect: true }, { text: `Testes e Simula√ß√µes.`, id: `E`, isCorrect: false } ], gabaritoComentado: `A implementa√ß√£o das estrat√©gias ocorre na fase "Fazer" (Do) ou "Desenvolvimento e Implementa√ß√£o da Resposta de GCN".` }
    ];

    let currentQuizQuestions = [];
    const questionsState = [];
    const questionsArea = document.getElementById('questions-area-main');
    const navGrid = document.getElementById('question-nav-grid');
    const finalizeButton = document.getElementById('finalize-button');
    const restartButton = document.getElementById('restart-button');
    const themeToggleButton = document.getElementById('theme-toggle-button');
    const answeredCountEl = document.getElementById('answered-count');
    const reviewCountEl = document.getElementById('review-count');
    const blankCountEl = document.getElementById('blank-count');

    const modeSelectionScreen = document.getElementById('mode-selection-screen');
    const quizMainContainer = document.getElementById('quiz-main-container');
    const startTimedButton = document.getElementById('start-timed-button');
    const startUntimedButton = document.getElementById('start-untimed-button');
    const quizHeaderBackButton = document.getElementById('back-button');
    const probabilityLegendContainer = document.getElementById('probability-legend-container');
    const probabilityLegendTitle = probabilityLegendContainer.querySelector('p:first-child');


    const timerDisplayContainer = document.getElementById('timer-display-container');
    const timerDisplay = document.getElementById('timer-display');

    let quizFinalized = false;
    let isTimedModeGlobal = false;
    let timerIntervalGlobal = null;
    let remainingSecondsGlobal = 0;
    const QUIZ_DURATION_SECONDS = 50 * 60;

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function buildCurrentQuiz() {
        currentQuizQuestions = [];

        let poolForSelection;
        if (isTimedModeGlobal) {
            poolForSelection = [...JSON.parse(JSON.stringify(baseFixedQuestions)), ...JSON.parse(JSON.stringify(randomizableQuestionPool))];
            shuffleArray(poolForSelection);
            currentQuizQuestions = poolForSelection.slice(0, 10);
            currentQuizQuestions.forEach((q, index) => {
                q.qNumberDisplay = (index + 1).toString();
                q.qId = `timed_q${index + 1}_${Date.now()}_${Math.random().toString(36).substring(7)}`;
            });
        } else {
            currentQuizQuestions = new Array(10).fill(null);
            const localBaseFixedQuestions = JSON.parse(JSON.stringify(baseFixedQuestions));
            const fixedMappingUntimed = [
                { quizSlot: 0, baseFixedIndex: 0, displayNumber: '1' },
                { quizSlot: 4, baseFixedIndex: 1, displayNumber: '5' },
                { quizSlot: 5, baseFixedIndex: 2, displayNumber: '6' },
                { quizSlot: 6, baseFixedIndex: 3, displayNumber: '7' },
                { quizSlot: 7, baseFixedIndex: 4, displayNumber: '8' }
            ];

            fixedMappingUntimed.forEach(map => {
                if (localBaseFixedQuestions[map.baseFixedIndex]) {
                    const questionData = localBaseFixedQuestions[map.baseFixedIndex];
                    questionData.qId = `${questionData.qIdPrefix || 'bfq_'}_slot${map.quizSlot}_${Date.now()}_${Math.random().toString(36).substring(7)}`;
                    questionData.qNumberDisplay = map.displayNumber;
                    currentQuizQuestions[map.quizSlot] = questionData;
                }
            });

            let availableRandomQuestions = JSON.parse(JSON.stringify(randomizableQuestionPool)).filter(
                rq => !currentQuizQuestions.some(cq => cq && cq.stableId === rq.stableId)
            );
            shuffleArray(availableRandomQuestions);

            let randomPoolIdx = 0;
            const randomDisplayNumbersUntimed = ['2', '3', '4', '9', '10'];
            const randomSlotsUntimed = [1, 2, 3, 8, 9];

            randomSlotsUntimed.forEach((slotIndex, k) => {
                if (currentQuizQuestions[slotIndex] === null) {
                    if (randomPoolIdx < availableRandomQuestions.length) {
                        const questionData = availableRandomQuestions[randomPoolIdx++];
                        questionData.qId = `${questionData.qIdPrefix || 'rand_'}_slot${slotIndex}_${Date.now()}_${randomPoolIdx}`;
                        questionData.qNumberDisplay = randomDisplayNumbersUntimed[k];
                        currentQuizQuestions[slotIndex] = questionData;
                    }
                }
            });
        }

        for (let i = 0; i < 10; i++) {
            if (!currentQuizQuestions[i]) {
                console.warn(`Slot ${i} (display ${i+1}) n√£o foi preenchido, usando fallback.`);
                const fallbackPool = isTimedModeGlobal ?
                                   [...JSON.parse(JSON.stringify(baseFixedQuestions)), ...JSON.parse(JSON.stringify(randomizableQuestionPool))] :
                                   JSON.parse(JSON.stringify(randomizableQuestionPool));

                let fallbackQ = fallbackPool[Math.floor(Math.random() * fallbackPool.length)];
                let attempts = 0;
                while (currentQuizQuestions.some(q => q && q.stableId === fallbackQ.stableId && currentQuizQuestions.indexOf(q) !== i) && attempts < fallbackPool.length * 2) {
                    fallbackQ = fallbackPool[Math.floor(Math.random() * fallbackPool.length)];
                    attempts++;
                }
                const questionData = JSON.parse(JSON.stringify(fallbackQ));
                questionData.qId = `fallback_q${i}_${Date.now()}_${Math.random().toString(36).substring(7)}`;
                questionData.qNumberDisplay = (i + 1).toString();
                currentQuizQuestions[i] = questionData;
            }
        }
    }


    function initializeQuizInterfaceForNewAttempt() {
        buildCurrentQuiz();
        questionsState.length = 0;
        currentQuizQuestions.forEach(() => {
            questionsState.push({ userSelectedOptionIndex: null, isAnswered: false, isMarkedForReview: false });
        });
        quizFinalized = false;
        quizHeaderBackButton.style.display = 'block';

        if (timerIntervalGlobal) clearInterval(timerIntervalGlobal);
        timerIntervalGlobal = null;
        remainingSecondsGlobal = QUIZ_DURATION_SECONDS;

        if (isTimedModeGlobal) {
            console.log("MODO COM TEMPO ATIVADO - Timer e legenda devem ser ajustados.");
            timerDisplayContainer.style.display = 'block';
            probabilityLegendContainer.style.display = 'none';
             if(probabilityLegendTitle) probabilityLegendTitle.textContent = "Legenda de Destaque";
            startTimer();
        } else {
            console.log("MODO SEM TEMPO ATIVADO - Timer e legenda devem ser ajustados.");
            timerDisplayContainer.style.display = 'none';
            probabilityLegendContainer.style.display = 'block';
            if(probabilityLegendTitle) probabilityLegendTitle.textContent = "Legenda de Destaque (Modo SEM TEMPO):";
        }
        renderQuestions();
    }

    function navigateToModeSelection() {
        if (timerIntervalGlobal) {
            clearInterval(timerIntervalGlobal);
            timerIntervalGlobal = null;
            console.log("Timer parado ao voltar para sele√ß√£o de modo.");
        }
        quizMainContainer.style.display = 'none';
        quizHeaderBackButton.style.display = 'none';
        modeSelectionScreen.classList.add('visible');
    }

    function startQuiz(timed) {
        console.log(`Iniciando quiz - Modo com tempo: ${timed}`);
        isTimedModeGlobal = timed;
        modeSelectionScreen.classList.remove('visible');
        quizMainContainer.style.display = 'flex';
        initializeQuizInterfaceForNewAttempt();
    }

    function renderQuestions() {
        console.log("Renderizando quest√µes. Modo com tempo:", isTimedModeGlobal);
        questionsArea.innerHTML = '';
        navGrid.innerHTML = '';
        questionsArea.classList.remove('quiz-finalized');
        navGrid.classList.remove('quiz-finalized');

        if (!currentQuizQuestions || currentQuizQuestions.length === 0) {
            questionsArea.innerHTML = "<p>Erro ao carregar quest√µes. Tente reiniciar.</p>";
            console.error("currentQuizQuestions est√° vazio ou indefinido em renderQuestions.");
            return;
        }

        currentQuizQuestions.forEach((qData, qIndex) => {
            if (!qData) {
                console.error(`Dados da quest√£o indefinidos no √≠ndice ${qIndex} durante renderiza√ß√£o.`);
                return;
            }

            const qBlock = document.createElement('div');
            qBlock.classList.add('question-block');
            qBlock.id = qData.qId;

            const qNum = document.createElement('span');
            qNum.classList.add('question-block-number');

            if (!isTimedModeGlobal) {
                // console.log(`Modo SEM TEMPO: Processando quest√£o ${qData.qNumberDisplay} (${qData.stableId}) com topicKey: ${qData.topicKey} e highlight: ${qData.highlight}`);
                if (qData.topicKey && topicProbabilities[qData.topicKey]) {
                    const probInfo = topicProbabilities[qData.topicKey];
                    qBlock.classList.add(`prob-${probInfo.colorVarSuffix}`);
                    // console.log(`   Aplicada classe de bloco: prob-${probInfo.colorVarSuffix}`);
                }
                if (qData.highlight) {
                    qNum.style.color = 'var(--feedback-incorrect)'; // VERMELHO para n√∫mero
                    // console.log(`   N√∫mero da quest√£o ${qData.qNumberDisplay} em VERMELHO`);
                    if (!qBlock.classList.contains('prob-high')) {
                        qBlock.classList.add('important-question'); // Borda Laranja se n√£o for j√° bloco vermelho
                        // console.log(`   Aplicada classe de borda: important-question`);
                    }
                }
            } else {
                // console.log(`Modo COM TEMPO: Quest√£o ${qData.qNumberDisplay} (${qData.stableId}), sem destaques visuais.`);
            }

            qNum.textContent = `Quest√£o ${qData.qNumberDisplay}`;
            const qHeader = document.createElement('div');
            qHeader.classList.add('question-block-header');
            qHeader.appendChild(qNum);
            const reviewBtn = document.createElement('button');
            reviewBtn.classList.add('question-block-review-btn');
            reviewBtn.textContent = questionsState[qIndex]?.isMarkedForReview ? `Desmarcar Revis√£o` : `Marcar para Revis√£o`;
            if (questionsState[qIndex]?.isMarkedForReview) reviewBtn.classList.add('marked');
            reviewBtn.disabled = quizFinalized;
            reviewBtn.addEventListener('click', () => toggleReview(qIndex));
            qHeader.appendChild(reviewBtn);

            const qText = document.createElement('div');
            qText.classList.add('question-block-text');
            qText.innerHTML = qData.text;
            if (qData.sourceRef) {
                const sourceSpan = document.createElement('span');
                sourceSpan.classList.add('source-reference');
                sourceSpan.textContent = qData.sourceRef;
                qText.appendChild(sourceSpan);
            }

            const qOptionsUl = document.createElement('ul');
            qOptionsUl.classList.add('question-block-options');
            if (qData.options && Array.isArray(qData.options)) {
                qData.options.forEach((opt, optIndex) => {
                    const optLi = document.createElement('li');
                    optLi.classList.add('option-item');
                    if (!quizFinalized && questionsState[qIndex]?.userSelectedOptionIndex === optIndex) {
                        optLi.classList.add('selected');
                    }
                    const optLetter = document.createElement('span');
                    optLetter.classList.add('option-letter');
                    optLetter.textContent = opt.id;
                    const optTextSpan = document.createElement('span');
                    optTextSpan.classList.add('option-text');
                    optTextSpan.innerHTML = opt.text;
                    optLi.appendChild(optLetter);
                    optLi.appendChild(optTextSpan);
                    optLi.addEventListener('click', () => {
                        // console.log(`Clique na op√ß√£o: Quest√£o ${qData.qNumberDisplay}, Op√ß√£o ${opt.id}`);
                        selectOption(qIndex, optIndex);
                    });
                    qOptionsUl.appendChild(optLi);
                });
            }

            const feedbackDiv = document.createElement('div');
            feedbackDiv.classList.add('gabarito-feedback');
            feedbackDiv.style.display = 'none';
            qBlock.appendChild(qHeader);
            qBlock.appendChild(qText);
            qBlock.appendChild(qOptionsUl);
            qBlock.appendChild(feedbackDiv);
            questionsArea.appendChild(qBlock);

            const navBtn = document.createElement('button');
            navBtn.classList.add('nav-grid-button');
            navBtn.textContent = qData.qNumberDisplay;
            navBtn.addEventListener('click', () => {
                const targetElement = document.getElementById(qData.qId);
                if (targetElement) targetElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                else console.warn("Elemento de navega√ß√£o n√£o encontrado:", qData.qId);
            });
            if (questionsState[qIndex]?.isAnswered && !quizFinalized) navBtn.classList.add('answered');
            if (questionsState[qIndex]?.isMarkedForReview && !quizFinalized) navBtn.classList.add('review');
            navGrid.appendChild(navBtn);
        });
        finalizeButton.style.display = 'block';
        restartButton.style.display = 'none';
        finalizeButton.textContent = 'Finalizar Prova';
        updateStatusCounts();
    }

    function startTimer() {
        console.log("startTimer chamado");
        if (timerIntervalGlobal) clearInterval(timerIntervalGlobal);
        updateTimerDisplay();
        timerIntervalGlobal = setInterval(() => {
            remainingSecondsGlobal--;
            updateTimerDisplay();
            if (remainingSecondsGlobal < 0) {
                console.log("Tempo esgotado, finalizando quiz automaticamente.");
                autoFinalizeQuiz();
            }
        }, 1000);
    }

    function updateTimerDisplay() {
        const minutes = Math.max(0, Math.floor(remainingSecondsGlobal / 60));
        const seconds = Math.max(0, remainingSecondsGlobal % 60);
        if (timerDisplay) { // Verifica se timerDisplay existe
            timerDisplay.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
    }

    function autoFinalizeQuiz() {
        if (timerIntervalGlobal) clearInterval(timerIntervalGlobal);
        timerIntervalGlobal = null;
        if (!quizFinalized) performFinalization(true);
    }

    function selectOption(qIndex, optIndex) {
        // console.log(`selectOption - qIndex: ${qIndex}, optIndex: ${optIndex}, quizFinalized: ${quizFinalized}`);
        if (quizFinalized) return;
        if (!questionsState[qIndex]) { console.error("Estado da quest√£o indefinido em selectOption para √≠ndice:", qIndex); return; }
        if (!currentQuizQuestions[qIndex]) { console.error("Quest√£o atual indefinida em selectOption para √≠ndice:", qIndex); return; }


        questionsState[qIndex].userSelectedOptionIndex = optIndex;
        questionsState[qIndex].isAnswered = true;

        const qBlock = document.getElementById(currentQuizQuestions[qIndex].qId);
        if (!qBlock) { console.error("Bloco da quest√£o n√£o encontrado em selectOption:", currentQuizQuestions[qIndex].qId); return; }
        const optionItems = qBlock.querySelectorAll('.option-item');
        optionItems.forEach((item, currentOptIndex) => item.classList.toggle('selected', currentOptIndex === optIndex));
        updateStatusCounts();
        updateNavGridButtonState(qIndex, false);
    }

    function toggleReview(qIndex) {
        if (quizFinalized) return;
        if (!questionsState[qIndex]) { console.error("Estado da quest√£o indefinido em toggleReview para √≠ndice:", qIndex); return; }
        if (!currentQuizQuestions[qIndex]) { console.error("Quest√£o atual indefinida em toggleReview para √≠ndice:", qIndex); return; }

        questionsState[qIndex].isMarkedForReview = !questionsState[qIndex].isMarkedForReview;

        const qBlock = document.getElementById(currentQuizQuestions[qIndex].qId);
        if (!qBlock) { console.error("Bloco da quest√£o n√£o encontrado em toggleReview:", currentQuizQuestions[qIndex].qId); return; }
        const reviewBtn = qBlock.querySelector('.question-block-review-btn');
        reviewBtn.textContent = questionsState[qIndex].isMarkedForReview ? `Desmarcar Revis√£o` : `Marcar para Revis√£o`;
        reviewBtn.classList.toggle('marked', questionsState[qIndex].isMarkedForReview);
        updateStatusCounts();
        updateNavGridButtonState(qIndex, false);
    }

    function updateStatusCounts() {
        let answered = 0, review = 0;
        const totalQs = currentQuizQuestions.length;

        if (totalQs > 0) {
            questionsState.forEach(qState => {
                if (qState && qState.isAnswered) answered++;
                if (qState && qState.isMarkedForReview) review++;
            });
            blankCountEl.textContent = totalQs - answered;
        } else {
            blankCountEl.textContent = 0; // Ou o n√∫mero total esperado se n√£o houver quest√µes
        }
        answeredCountEl.textContent = answered;
        reviewCountEl.textContent = review;

        if (!quizFinalized) {
            finalizeButton.disabled = !(totalQs > 0 && answered === totalQs);
            finalizeButton.title = finalizeButton.disabled ? `Responda todas as ${totalQs > 0 ? totalQs : 10} quest√µes para finalizar.` : "Finalizar a prova";
        }
    }

    function updateNavGridButtonState(qIndex, isFinalizedView) {
        const navButtons = navGrid.querySelectorAll('.nav-grid-button');
        if (!currentQuizQuestions || !currentQuizQuestions[qIndex]) return;
        const targetNavButton = Array.from(navButtons).find(btn => btn.textContent === currentQuizQuestions[qIndex].qNumberDisplay);
        if (targetNavButton) {
            targetNavButton.className = 'nav-grid-button';
            if (isFinalizedView) {
                const userChoiceIndex = questionsState[qIndex]?.userSelectedOptionIndex;
                const correctOptionIndex = currentQuizQuestions[qIndex].options.findIndex(opt => opt.isCorrect);
                if (userChoiceIndex === null || typeof userChoiceIndex === 'undefined') targetNavButton.classList.add('nav-grid-unanswered');
                else if (userChoiceIndex === correctOptionIndex) targetNavButton.classList.add('nav-grid-correct');
                else targetNavButton.classList.add('nav-grid-incorrect');
            } else {
                if (questionsState[qIndex]?.isAnswered) targetNavButton.classList.add('answered');
                if (questionsState[qIndex]?.isMarkedForReview) targetNavButton.classList.add('review');
            }
        }
    }

    function performFinalization(isAutoFinalized = false) {
        if (quizFinalized && !isAutoFinalized) return;
        if (quizFinalized && isAutoFinalized && finalizeButton.disabled) return;

        quizFinalized = true;
        quizHeaderBackButton.style.display = 'none';
        if (timerIntervalGlobal && !isAutoFinalized) {
            clearInterval(timerIntervalGlobal);
            timerIntervalGlobal = null;
            console.log("Timer parado ao finalizar manualmente.");
        } else if (timerIntervalGlobal && isAutoFinalized) {
             clearInterval(timerIntervalGlobal); // Garante que parou se foi auto-finalizado
            timerIntervalGlobal = null;
            console.log("Timer parado por auto-finaliza√ß√£o.");
        }

        finalizeButton.disabled = true;
        finalizeButton.textContent = 'Prova Finalizada';
        finalizeButton.style.display = 'none';
        restartButton.style.display = 'block';
        questionsArea.classList.add('quiz-finalized');
        navGrid.classList.add('quiz-finalized');
        document.querySelectorAll('.question-block-review-btn').forEach(btn => btn.disabled = true);
        let correctAnswersCount = 0;
        currentQuizQuestions.forEach((qData, qIndex) => {
            const qBlock = document.getElementById(qData.qId);
            if (!qBlock) { console.error("Bloco da quest√£o n√£o encontrado para finaliza√ß√£o:", qData.qId); return; }
            const optionItems = qBlock.querySelectorAll('.option-item');
            const feedbackDiv = qBlock.querySelector('.gabarito-feedback');
             if (!feedbackDiv) { console.error("Div de feedback n√£o encontrada para:", qData.qId); return; }

            const userChoiceIndex = questionsState[qIndex]?.userSelectedOptionIndex;
            const correctOptionObj = qData.options.find(opt => opt.isCorrect);
            const correctOptionIndex = qData.options.indexOf(correctOptionObj);
            let feedbackHTML = ``;
            if (userChoiceIndex !== null && typeof userChoiceIndex !== 'undefined') {
                const isUserCorrect = userChoiceIndex === correctOptionIndex;
                if(isUserCorrect) correctAnswersCount++;
                feedbackHTML += `<p><strong>Sua resposta:</strong> Op√ß√£o ${qData.options[userChoiceIndex]?.id || 'Inv√°lida'}</p>`;
                if (isUserCorrect) {
                    feedbackDiv.className = 'gabarito-feedback correct';
                    feedbackHTML += `<p><strong>Resultado:</strong> Correto!</p>`;
                    if(optionItems[userChoiceIndex]) optionItems[userChoiceIndex].classList.add('user-correct');
                } else {
                    feedbackDiv.className = 'gabarito-feedback incorrect';
                    feedbackHTML += `<p><strong>Resultado:</strong> Incorreto.</p>`;
                    if(optionItems[userChoiceIndex]) optionItems[userChoiceIndex].classList.add('user-incorrect');
                }
            } else {
                feedbackDiv.className = 'gabarito-feedback incorrect';
                feedbackHTML += `<p><strong>Sua resposta:</strong> Nenhuma op√ß√£o selecionada.</p>`;
                feedbackHTML += `<p><strong>Resultado:</strong> Incorreto.</p>`;
            }
            feedbackHTML += `<p><strong>Resposta correta:</strong> Op√ß√£o ${correctOptionObj.id} - ${correctOptionObj.text}</p>`;
            if (qData.gabaritoComentado) feedbackHTML += `<p class="gabarito-comentario"><strong>Coment√°rio:</strong> ${qData.gabaritoComentado}</p>`;
            feedbackDiv.innerHTML = feedbackHTML;
            feedbackDiv.style.display = 'block';
            if (correctOptionIndex !== -1 && optionItems[correctOptionIndex]) optionItems[correctOptionIndex].classList.add('actual-correct');
            optionItems.forEach(optItem => { optItem.style.cursor = 'default'; optItem.classList.remove('selected'); });
            updateNavGridButtonState(qIndex, true);
        });
        if (isAutoFinalized) {
            const timeUpMsg = document.createElement('div');
            timeUpMsg.innerHTML = `<h3>Tempo Esgotado!</h3><p>Sua prova foi finalizada automaticamente.</p>`;
            timeUpMsg.style.cssText = "background-color: var(--feedback-incorrect-bg); color: var(--feedback-incorrect-text); border: 1px solid var(--feedback-incorrect); padding: 15px; border-radius: var(--border-radius-md); text-align: center; font-weight: bold; margin-bottom: 20px;";
            const firstQuestionBlock = questionsArea.querySelector('.question-block');
            if (firstQuestionBlock) questionsArea.insertBefore(timeUpMsg, firstQuestionBlock);
            else questionsArea.appendChild(timeUpMsg);
        }
    }

    finalizeButton.addEventListener('click', () => performFinalization(false));
    restartButton.addEventListener('click', navigateToModeSelection);
    quizHeaderBackButton.addEventListener('click', navigateToModeSelection);
    themeToggleButton.addEventListener('click', () => {
        document.body.classList.toggle('dark-theme');
        const isDarkMode = document.body.classList.contains('dark-theme');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        themeToggleButton.textContent = isDarkMode ? '‚òÄÔ∏è' : 'üåô';
    });
    startTimedButton.addEventListener('click', () => startQuiz(true));
    startUntimedButton.addEventListener('click', () => startQuiz(false));
    const savedTheme = localStorage.getItem('theme');
    const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
    if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
        document.body.classList.add('dark-theme');
        themeToggleButton.textContent = '‚òÄÔ∏è';
    } else {
        document.body.classList.remove('dark-theme');
        themeToggleButton.textContent = 'üåô';
    }
    navigateToModeSelection();
});
    </script>
</body>
</html>
