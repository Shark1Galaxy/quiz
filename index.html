<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plataforma de Estudo: Segurança da Informação</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Lora:wght@400;500;600;700&display=swap');

        :root {
            /* Light Theme (Default) */
            --font-primary: 'Inter', sans-serif;
            --font-display: 'Lora', serif; /* Uma fonte serifada elegante para títulos */

            --bg-light-primary: #ffffff;
            --bg-light-secondary: #f7f9fc; /* Fundo de página ultra claro */
            --bg-light-tertiary: #eef2f7; /* Para hovers sutis e fundos de elementos */
            
            --text-light-primary: #1f2328; /* Preto suave */
            --text-light-secondary: #57606a; /* Cinza escuro */
            --text-light-tertiary: #8c95a1; /* Cinza médio */

            --border-light-primary: #dfe3e8; /* Borda sutil */
            --border-light-secondary: #ced4da;

            --accent-light-primary: #007aff; /* Azul Apple como primário */
            --accent-light-primary-darker: #005ecb;
            --accent-light-primary-lighter: #e6f2ff; 
            
            --feedback-correct-light: #34c759; /* Verde Apple */
            --feedback-correct-bg-light: #eaf7ec;
            --feedback-correct-text-light: #1c6c37;

            --feedback-incorrect-light: #ff3b30; /* Vermelho Apple */
            --feedback-incorrect-bg-light: #ffebee;
            --feedback-incorrect-text-light: #a6130a;

            --feedback-review-light: #ffcc00; /* Amarelo Apple */
            --feedback-review-bg-light: #fff9e6;
            --feedback-review-text-light: #7a5f00;

            /* Dark Theme Overrides */
            --bg-dark-primary: #161b22; /* GitHub Dark Background */
            --bg-dark-secondary: #0d1117; /* GitHub Dark Page Background */
            --bg-dark-tertiary: #21262d; /* GitHub Dark Borders/Hover */
            
            --text-dark-primary: #c9d1d9; /* GitHub Dark Primary Text */
            --text-dark-secondary: #8b949e; /* GitHub Dark Secondary Text */
            --text-dark-tertiary: #6e7681;

            --border-dark-primary: #30363d; /* GitHub Dark Borders */
            --border-dark-secondary: #49515a;

            --accent-dark-primary: #58a6ff; /* GitHub Dark Blue Accent */
            --accent-dark-primary-darker: #388bfd;
            --accent-dark-primary-lighter: #1e4278; 
            
            --feedback-correct-dark: #56d364; /* GitHub Dark Green */
            --feedback-correct-bg-dark: #1c3027;
            --feedback-correct-text-dark: #7ee787;

            --feedback-incorrect-dark: #f85149; /* GitHub Dark Red */
            --feedback-incorrect-bg-dark: #382025;
            --feedback-incorrect-text-dark: #ffa198;

            --feedback-review-dark: #e3b341; /* GitHub Dark Yellow */
            --feedback-review-bg-dark: #342f20;
            --feedback-review-text-dark: #f0c659;

            /* CSS Variables for current theme */
            --bg-page: var(--bg-light-secondary);
            --bg-header: var(--bg-light-primary);
            --bg-card: var(--bg-light-primary);
            --bg-sidebar: var(--bg-light-primary);
            --bg-element: var(--bg-light-tertiary); /* Para botões de letra, etc. */
            --bg-hover: var(--accent-light-primary-lighter);
            --bg-selected: var(--accent-light-primary-lighter);
            
            --text-primary: var(--text-light-primary);
            --text-secondary: var(--text-light-secondary);
            --text-tertiary: var(--text-light-tertiary);
            
            --border: var(--border-light-primary);
            --border-medium: var(--border-light-secondary);
            
            --accent-primary: var(--accent-light-primary);
            --accent-primary-darker: var(--accent-light-primary-darker);
            
            --feedback-correct: var(--feedback-correct-light);
            --feedback-correct-bg: var(--feedback-correct-bg-light);
            --feedback-correct-text: var(--feedback-correct-text-light);
            
            --feedback-incorrect: var(--feedback-incorrect-light);
            --feedback-incorrect-bg: var(--feedback-incorrect-bg-light);
            --feedback-incorrect-text: var(--feedback-incorrect-text-light);
            
            --feedback-review: var(--feedback-review-light);
            --feedback-review-bg: var(--feedback-review-bg-light);
            --feedback-review-text: var(--feedback-review-text-light);

            --shadow-sm: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 10px rgba(0,0,0,0.05), 0 2px 6px rgba(0,0,0,0.04);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.06), 0 5px 12px rgba(0,0,0,0.05);

            --border-radius-sm: 4px;
            --border-radius-md: 8px;
            --border-radius-lg: 12px;
        }

        body.dark-theme {
            --bg-page: var(--bg-dark-secondary);
            --bg-header: var(--bg-dark-primary);
            --bg-card: var(--bg-dark-primary);
            --bg-sidebar: var(--bg-dark-primary);
            --bg-element: var(--bg-dark-tertiary);
            --bg-hover: var(--accent-dark-primary-lighter);
            --bg-selected: var(--accent-dark-primary-lighter);
            
            --text-primary: var(--text-dark-primary);
            --text-secondary: var(--text-dark-secondary);
            --text-tertiary: var(--text-dark-tertiary);
            
            --border: var(--border-dark-primary);
            --border-medium: var(--border-dark-secondary);
            
            --accent-primary: var(--accent-dark-primary);
            --accent-primary-darker: var(--accent-dark-primary-darker);
            
            --feedback-correct: var(--feedback-correct-dark);
            --feedback-correct-bg: var(--feedback-correct-bg-dark);
            --feedback-correct-text: var(--feedback-correct-text-dark);
            
            --feedback-incorrect: var(--feedback-incorrect-dark);
            --feedback-incorrect-bg: var(--feedback-incorrect-bg-dark);
            --feedback-incorrect-text: var(--feedback-incorrect-text-dark);
            
            --feedback-review: var(--feedback-review-dark);
            --feedback-review-bg: var(--feedback-review-bg-dark);
            --feedback-review-text: var(--feedback-review-text-dark);

            --shadow-sm: 0 1px 3px rgba(0,0,0,0.3), 0 1px 2px rgba(0,0,0,0.25);
            --shadow-md: 0 4px 10px rgba(0,0,0,0.3), 0 2px 6px rgba(0,0,0,0.25);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.35), 0 5px 12px rgba(0,0,0,0.3);
        }

        /* Reset e Base */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-primary);
            background-color: var(--bg-page);
            color: var(--text-primary);
            line-height: 1.65;
            padding: 0;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        ul { list-style: none; }
        button {
            font-family: inherit;
            border: none;
            background: none;
            cursor: pointer;
        }

        /* Theme Toggle Button */
        #theme-toggle-button {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            border-radius: var(--border-radius-md);
            width: 44px;
            height: 44px;
            font-size: 1.25em;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: var(--shadow-sm);
            transition: all 0.2s ease;
            z-index: 1001; /* Acima de outros elementos fixos */
        }
        #theme-toggle-button:hover {
            background-color: var(--bg-element);
            color: var(--accent-primary);
            transform: translateY(-2px);
        }

        /* Layout Principal */
        .page-header-container {
            background-color: var(--bg-header);
            padding: 20px 30px;
            box-shadow: var(--shadow-sm);
            border-bottom: 1px solid var(--border);
            position: sticky; /* Cabeçalho fixo */
            top: 0;
            z-index: 1000; /* Acima do conteúdo */
            width: 100%;
        }
        .page-main-title {
            font-family: var(--font-display);
            font-size: 1.8em; /* Reduzido para caber no header fixo */
            font-weight: 600; /* Menos pesado para elegância */
            color: var(--text-primary);
            text-align: center;
        }
        .quiz-page-container {
            display: flex;
            max-width: 1600px; /* Layout mais largo */
            margin: 25px auto; /* Margem superior considera header fixo */
            background-color: transparent; /* Container principal transparente */
            box-shadow: none; /* Removida sombra, cards terão a sua */
            border-radius: 0;
            padding: 0 20px; /* Padding lateral para espaçamento */
        }
        .questions-area {
            flex: 3; /* Mais espaço para questões */
            padding-right: 25px; /* Espaço antes da sidebar */
            background-color: transparent;
        }
        .sidebar-area {
            flex: 1; /* Sidebar ocupa menos espaço relativo */
            max-width: 360px; /* Largura máxima da sidebar */
            background-color: var(--bg-sidebar);
            padding: 25px;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 100px; /* Abaixo do header fixo (altura aproximada do header + margem) */
            height: calc(100vh - 125px); /* Ajuste altura */
            overflow-y: auto;
        }

        /* Bloco da Questão */
        .question-block {
            background-color: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--border-radius-md);
            margin-bottom: 30px;
            padding: 25px;
            box-shadow: var(--shadow-md);
        }
        .question-block-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border);
        }
        .question-block-number {
            font-family: var(--font-heading); font-size: 1.2em; font-weight: 600; color: var(--accent-primary);
        }
        .question-block-number.highlight-red { color: var(--feedback-incorrect); }
        .question-block-review-btn {
            font-family: var(--font-heading); background-color: var(--bg-element); color: var(--text-secondary);
            border: 1px solid transparent; padding: 7px 15px; border-radius: var(--border-radius-lg);
            font-size: 0.8em; font-weight: 500; letter-spacing: 0.3px; transition: all 0.2s ease;
        }
        .question-block-review-btn:hover:not(:disabled) {
            background-color: var(--accent-light-primary-lighter); border-color: var(--accent-primary); color: var(--accent-primary);
        }
        body.dark-theme .question-block-review-btn:hover:not(:disabled) {
            background-color: var(--accent-dark-primary-lighter); border-color: var(--accent-dark-primary); color: var(--accent-dark-primary);
        }
        .question-block-review-btn.marked {
            background-color: var(--feedback-review-bg); border-color: var(--feedback-review); color: var(--feedback-review-text);
        }
        .question-block-review-btn:disabled { opacity: 0.7; cursor: not-allowed; }
        .question-block-text {
            margin-bottom: 20px; font-size: 1.05em; color: var(--text-primary); line-height: 1.7;
        }
        .question-block-text strong { font-weight: 600; }
        .question-block-text .source-reference {
            font-size: 0.8em; color: var(--text-tertiary); margin-top: 12px; display: block; font-style: italic;
        }

        /* Opções */
        .option-item {
            background-color: var(--bg-card); border: 1.5px solid var(--border); border-radius: var(--border-radius-md);
            padding: 15px; margin-bottom: 10px; display: flex; align-items: center; cursor: pointer;
            transition: all 0.15s ease-in-out;
        }
        .option-item:hover:not(.quiz-finalized .option-item) {
            border-color: var(--accent-primary); background-color: var(--bg-hover); transform: scale(1.01);
        }
        .option-item.selected:not(.quiz-finalized .option-item) {
            border-color: var(--accent-primary) !important; background-color: var(--bg-selected) !important;
            /* box-shadow: 0 0 0 2px var(--accent-primary-lighter); */
        }
        .option-item.selected:not(.quiz-finalized .option-item) .option-letter {
             background-color: var(--accent-primary); color: var(--bg-card);
        }
        .option-letter {
            font-family: var(--font-heading); background-color: var(--bg-element); color: var(--text-secondary);
            border-radius: 50%; min-width: 28px; height: 28px; display: inline-flex;
            justify-content: center; align-items: center; font-weight: 500; /* Mais leve */
            margin-right: 12px; font-size: 0.85em; transition: background-color 0.2s, color 0.2s;
        }
        .option-text { font-size: 1em; color: var(--text-primary); flex-grow: 1; }

        /* Feedback e Gabarito */
        .gabarito-feedback {
            margin-top: 18px; padding: 15px; border-radius: var(--border-radius-sm); font-size: 0.95em;
            border-left-width: 4px; border-left-style: solid;
        }
        .gabarito-feedback.correct {
            background-color: var(--feedback-correct-bg); color: var(--feedback-correct-text); border-left-color: var(--feedback-correct);
        }
        .gabarito-feedback.incorrect {
            background-color: var(--feedback-incorrect-bg); color: var(--feedback-incorrect-text); border-left-color: var(--feedback-incorrect);
        }
        .gabarito-feedback p { margin: 5px 0; }
        .gabarito-feedback strong { font-weight: 600; }
        .gabarito-feedback .gabarito-comentario {
            margin-top: 10px; padding-top: 10px; border-top: 1px dashed var(--border);
            font-size: 0.9em; color: var(--text-secondary);
        }
        .quiz-finalized .option-item { cursor: default; }
        .quiz-finalized .option-item.selected { box-shadow: none; }
        .quiz-finalized .option-item.user-correct {
            background-color: var(--feedback-correct-bg) !important; border-color: var(--feedback-correct) !important;
        }
        .quiz-finalized .option-item.user-correct .option-letter {
            background-color: var(--feedback-correct) !important; color: var(--bg-card) !important;
        }
        .quiz-finalized .option-item.user-incorrect {
            background-color: var(--feedback-incorrect-bg) !important; border-color: var(--feedback-incorrect) !important; opacity: 0.9;
        }
        .quiz-finalized .option-item.user-incorrect .option-letter {
            background-color: var(--feedback-incorrect) !important; color: var(--bg-card) !important;
        }
        .quiz-finalized .option-item.actual-correct {
            border-width: 2px; border-color: var(--feedback-correct) !important;
        }
         .quiz-finalized .option-item.actual-correct:not(.user-correct) .option-letter {
             background-color: var(--feedback-correct) !important; color: var(--bg-card) !important;
        }

        /* Sidebar */
        #question-nav-header {
            font-family: var(--font-heading); font-size: 1.25em; font-weight: 600; /* Ajustado */
            margin-bottom: 18px; color: var(--text-primary); padding-bottom: 10px;
            border-bottom: 1px solid var(--border); /* Borda mais sutil */
        }
        #question-nav-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); /* Ajuste minmax */
            gap: 8px; margin-bottom: 20px;
        }
        .nav-grid-button {
            font-family: var(--font-heading); background-color: var(--bg-card); border: 1px solid var(--border);
            color: var(--text-secondary); padding: 8px 0; border-radius: var(--border-radius-sm);
            text-align: center; cursor: pointer; font-size: 0.9em; font-weight: 500;
            transition: all 0.15s ease-out;
        }
        .nav-grid-button:hover:not(.quiz-finalized .nav-grid-button) {
            background-color: var(--bg-hover); color: var(--accent-primary); border-color: var(--accent-primary);
        }
        .nav-grid-button.answered:not(.quiz-finalized .nav-grid-button) { 
            background-color: var(--accent-primary); color: var(--bg-card); border-color: var(--accent-primary-darker);
        }
        .nav-grid-button.review:not(.quiz-finalized .nav-grid-button) {
            border-color: var(--feedback-review); background-color: var(--feedback-review-bg); color: var(--feedback-review-text);
        }
        .quiz-finalized .nav-grid-button.nav-grid-correct {
            background-color: var(--feedback-correct-bg); border-color: var(--feedback-correct); color: var(--feedback-correct-text); font-weight: 600;
        }
        .quiz-finalized .nav-grid-button.nav-grid-incorrect {
            background-color: var(--feedback-incorrect-bg); border-color: var(--feedback-incorrect); color: var(--feedback-incorrect-text); font-weight: 600;
        }
         .quiz-finalized .nav-grid-button.nav-grid-unanswered {
            background-color: var(--bg-element); border-color: var(--border); color: var(--text-tertiary); opacity: 0.8;
        }

        /* Status e Botões da Sidebar */
        .status-summary p {
            font-family: var(--font-sans); font-size: 0.88em; margin: 8px 0; display: flex;
            align-items: center; color: var(--text-secondary);
        }
        .status-summary p strong { font-weight: 600; margin-left: 5px; color: var(--text-primary); }
        .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 7px;}
        .answered-dot { background-color: var(--accent-primary); }
        .review-dot { background-color: var(--feedback-review); }
        .blank-dot { background-color: var(--text-tertiary); }
        .sidebar-button {
            font-family: var(--font-heading); color: var(--bg-card); border: none;
            padding: 12px 0; /* Menor padding */
            width: 100%; border-radius: var(--border-radius-md);
            cursor: pointer; font-size: 0.95em; font-weight: 600; /* Ajustado */
            margin-top: 18px; transition: all 0.2s ease; text-transform: uppercase; letter-spacing: 0.5px;
            box-shadow: var(--shadow-sm);
        }
        .sidebar-button:first-of-type { margin-top: 20px; }
        .sidebar-button:hover:not(:disabled) { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .sidebar-button:active:not(:disabled) { transform: translateY(0px); box-shadow: var(--shadow-sm); }
        .sidebar-button:disabled {
            background-color: var(--border-medium) !important; color: var(--text-tertiary) !important;
            cursor: not-allowed; transform: none; box-shadow: none;
        }
        #finalize-button { background-color: var(--feedback-correct); }
        #finalize-button:hover:not(:disabled) { background-color: #11a372; } /* Ajustar cor de hover */
        #restart-button { background-color: var(--accent-primary); }
        #restart-button:hover:not(:disabled) { background-color: var(--accent-primary-darker); }

        /* Rodapé */
        .page-footer {
            text-align: center;
            padding: 25px 20px;
            margin-top: 30px; /* Espaço acima do rodapé */
            background-color: var(--bg-header); /* Consistente com o header */
            color: var(--text-secondary);
            font-size: 0.85em;
            border-top: 1px solid var(--border);
        }
        .page-footer p { margin: 0; }

    </style>
</head>
<body>
    <button id="theme-toggle-button" title="Alternar Tema">🌙</button>
    <header class="page-header-container">
        <h1 class="page-main-title">Plataforma de Estudo: Segurança da Informação</h1>
    </header>

    <div class="quiz-page-container">
        <div class="questions-area" id="questions-area-main">
            </div>
        <div class="sidebar-area">
            <div id="question-nav-header">Navegação</div>
            <div id="question-nav-grid">
                </div>
            <div class="status-summary">
                <p><span class="status-dot answered-dot"></span> Respondidas: <strong id="answered-count">0</strong></p>
                <p><span class="status-dot review-dot"></span> Revisão: <strong id="review-count">0</strong></p>
                <p><span class="status-dot blank-dot"></span> Em branco: <strong id="blank-count">0</strong></p>
            </div>
            <button id="finalize-button" class="sidebar-button" title="Responda todas as questões para finalizar">Finalizar prova</button>
            <button id="restart-button" class="sidebar-button" style="display: none;">Refazer prova</button>
        </div>
    </div>

    <footer class="page-footer">
        <p>Desenvolvido por Marcos Vinicius - Estudante de Análise e Desenvolvimento de Sistemas.</p>
    </footer>

    <script>
        // O JavaScript da resposta anterior permanece o mesmo.
        // Apenas certifique-se de que a lógica para habilitar/desabilitar o botão
        // "Finalizar Prova" e a atualização dos botões da grade está correta.
        // O JavaScript para o toggle de tema também será adicionado.

        document.addEventListener('DOMContentLoaded', () => {
            const fixedQuestionDefinitions = [
                {
                    qIdPrefix: `fixed_q1_`, 
                    originalQNumberDisplay: `1`, 
                    highlight: true, 
                    sourceRef: `[Fonte: ATIVIDADES - INTRODUÇÃO A SEGURANÇA DA INFORMAÇÃO.pdf, p. 1, Q1]`,
                    text: `(FCC/2010) Sobre segurança da informação, considere:<br><strong>I.</strong> Ameaça: algo que possa provocar danos à segurança da informação, prejudicar as ações da empresa e sua sustentação no negócio, mediante a exploração de uma determinada vulnerabilidade.<br><strong>II.</strong> Vulnerabilidade: é medida pela probabilidade de uma ameaça acontecer e o dano potencial à empresa.<br><strong>III.</strong> Risco: ponto pelo qual alguém pode ser atacado, molestado ou ter suas informações corrompidas.<br>Está correto o que consta APENAS em:`,
                    options: [
                        { text: `II e III`, id: `A`, isCorrect: false }, { text: `I e II`, id: `B`, isCorrect: false },
                        { text: `I e III`, id: `C`, isCorrect: false }, { text: `I`, id: `D`, isCorrect: true }, 
                        { text: `III`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `Os itens II e III apresentam os conceitos invertidos. Vulnerabilidade é o ponto pelo qual se pode ser atacado (como em III), e Risco é medido pela probabilidade e dano (como em II). A definição de Ameaça (I) está correta.`
                },
                {
                    qIdPrefix: `fixed_q5_`, originalQNumberDisplay: `5`, highlight: true,
                    sourceRef: `[Fonte: Prova AV.pdf, p. 3, Q5]`,
                    text: `(UFPB/2019-Adaptada) A segurança da informação é uma área crucial em um mundo cada vez mais digital e conectado... O Phishing é um tipo de ameaça virtual bastante comum... Em relação ao Phishing, assinale a alternativa correta.`,
                    options: [
                        { text: `É o termo usado para se referir aos e-mails não solicitados...`, id: `A`, isCorrect: false },
                        { text: `São programas especificamente desenvolvidos para executar ações danosas...`, id: `B`, isCorrect: false },
                        { text: `É um software projetado para monitorar as atividades de um sistema...`, id: `C`, isCorrect: false },
                        { text: `São programas, ou parte de um programa de computador, normalmente maliciosos...`, id: `D`, isCorrect: false },
                        { text: `É um método de envio de mensagens eletrônicas que tentam se passar pela comunicação oficial...`, id: `E`, isCorrect: true }
                    ],
                    gabaritoComentado: `Phishing é uma técnica fraudulenta que usa mensagens falsas para enganar usuários e obter informações confidenciais.`
                },
                {
                    qIdPrefix: `fixed_q6_`, originalQNumberDisplay: `6`, highlight: true,
                    sourceRef: `[Fonte: Prova AV.pdf, p. 5, Q6]`,
                    text: `Assinale a opção correta a respeito de segurança da informação, análise de riscos e medidas de segurança física e lógica.`,
                    options: [
                        { text: `Analisar riscos consiste em enumerar todos os tipos de risco...`, id: `A`, isCorrect: true },
                        { text: `Em análises de riscos, é necessário levar em conta os possíveis ataques...`, id: `B`, isCorrect: false },
                        { text: `As medidas de segurança dividem-se em dois tipos: as preventivas e as corretivas.`, id: `C`, isCorrect: false },
                        { text: `Como medida de segurança corretiva utilizam-se firewalls e criptografia.`, id: `D`, isCorrect: false },
                        { text: `Como medida de segurança preventiva utilizam-se controle de acesso lógico e sessão de autenticação.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `A análise de riscos envolve a identificação de riscos, suas causas, consequências e a probabilidade de ocorrência.`
                },
                {
                    qIdPrefix: `fixed_q7_`, originalQNumberDisplay: `7`, highlight: true,
                    sourceRef: `[Fonte: ATIVIDADES - INTRODUÇÃO A SEGURANÇA DA INFORMAÇÃO.pdf, p. 13, Q7]`,
                    text: `Redes de computadores conectadas à internet são alvos de invasões por parte de hackers. A ferramenta para permitir o acesso à rede apenas por endereços autorizados é: `,
                    options: [
                        { text: `Criptografia.`, id: `A`, isCorrect: false }, { text: `Firewall.`, id: `B`, isCorrect: true },
                        { text: `Certificado digital.`, id: `C`, isCorrect: false }, { text: `Antivírus.`, id: `D`, isCorrect: false },
                        { text: `Modem.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `O Firewall controla o tráfego de rede com base em regras para proteger contra acessos não autorizados.`
                },
                {
                    qIdPrefix: `fixed_q8_`, originalQNumberDisplay: `8`, highlight: true,
                    sourceRef: `[Fonte: Prova AV.pdf, p. 6, Q8]`,
                    text: `O risco residual é assim classificado quando não se tem uma resposta adequada ao risco, ou ele é considerado mínimo. Mesmo assim, deve passar pela etapa de:`,
                    options: [
                        { text: `Comunicação e consulta do risco.`, id: `A`, isCorrect: false }, { text: `Aceitação do crivo.`, id: `B`, isCorrect: false },
                        { text: `Tratamento do risco.`, id: `C`, isCorrect: false }, { text: `Monitoramento e análise crítica de riscos.`, id: `D`, isCorrect: true },
                        { text: `Marcação do critério.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `Riscos residuais devem ser continuamente monitorados e analisados criticamente.`
                }
            ];

            const randomizableQuestionPool = [
                 {
                    qIdPrefix: `rand_`, 
                    sourceRef: `[Fonte: ATIVIDADES PDF, p. 1, Q2]`,
                    text: `(FCC/2012- Adaptada) Códigos maliciosos (malwares) ... bots e botnets, sobre os quais é correto afirmar:`,
                    options: [
                        { text: `Botnet é um software malicioso de monitoramento de rede...`, id: `A`, isCorrect: false },
                        { text: `Bot é um programa que dispõe de mecanismos de comunicação...`, id: `B`, isCorrect: false },
                        { text: `Um computador infectado por um bot costuma ser chamado de attack base...`, id: `C`, isCorrect: false },
                        { text: `A comunicação entre o invasor e o computador infectado...`, id: `D`, isCorrect: false },
                        { text: `Algumas das ações maliciosas que costumam ser executadas por botnets são: ataques de negação de serviço...`, id: `E`, isCorrect: true }
                    ],
                    gabaritoComentado: `Botnets são redes de computadores infectados para realizar ataques em massa.`
                },
                {
                    qIdPrefix: `rand_`, sourceRef: `[Fonte: ATIVIDADES PDF, p. 2, Q3]`,
                    text: `É um tipo de malware feito para extorquir dinheiro de sua vítima... O texto se refere ao:`,
                    options: [
                        { text: `Spyware`, id: `A`, isCorrect: false },{ text: `Botnet`, id: `B`, isCorrect: false },
                        { text: `Spam`, id: `C`, isCorrect: false },{ text: `DDOS`, id: `D`, isCorrect: false },
                        { text: `Ransomware`, id: `E`, isCorrect: true }
                    ],
                    gabaritoComentado: `O enunciado descreve o Ransomware.`
                },
                {
                    qIdPrefix: `rand_`, sourceRef: `[Fonte: ATIVIDADES PDF, p. 9, Q1 "Princípios"]`,
                    text: `Qual das seguintes políticas é mais comumente recomendada no mercado quando se trata de regras de firewalls?`,
                    options: [
                        { text: `Aceitar todos por padrão, negar alguns.`, id: `A`, isCorrect: false }, { text: `Negar por padrão, autorizar explicitamente.`, id: `B`, isCorrect: true },
                        { text: `Aceitar por padrão, negar por exceção.`, id: `C`, isCorrect: false }, { text: `Autorizar todos por padrão, restringir alguns.`, id: `D`, isCorrect: false },
                        { text: `Negar todos por padrão, sem exceções.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `A política "Negar por padrão, autorizar explicitamente" é a mais segura.`
                },
                {
                    qIdPrefix: `rand_`, sourceRef: `[Fonte: ATIVIDADES PDF, p. 19, Q5 "Normas"]`,
                    text: `A tríade CID é uma forma simplificada de representar os múltiplos objetivos da segurança da informação. O que a tríade CID, que o SGSI busca preservar, representa?`,
                    options: [
                        { text: `Complacência, Integridade, Durabilidade.`, id: `A`, isCorrect: false }, { text: `Confidencialidade, Integridade, Disponibilidade.`, id: `B`, isCorrect: true },
                        { text: `Consistência, Implementação, Durabilidade.`, id: `C`, isCorrect: false }, { text: `Computação, Internet, Dados.`, id: `D`, isCorrect: false },
                        { text: `Certificação, Inovação, Desenvolvimento.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `CID: Confidencialidade, Integridade e Disponibilidade.`
                },
                {
                    qIdPrefix: `rand_`, sourceRef: `[Fonte: ATIVIDADES PDF p. 24, Q3 "Boas Práticas"]`,
                    text: `Complete a frase corretamente: "as funções de hash, por exemplo, são adequadas para garantir a integridade dos dados, porque ..."`,
                    options: [
                        { text: `Qualquer alteração feita no conteúdo de uma mensagem fará com que o receptor calcule um valor de hash diferente...`, id: `A`, isCorrect: true },
                        { text: `Geralmente podem ser calculadas muito mais rápido que os valores de criptografia...`, id: `B`, isCorrect: false },
                        { text: `Usam chave única para criptografar e descriptografar a mensagem.`, id: `C`, isCorrect: false },
                        { text: `Fazem a troca de chaves na chave simétrica.`, id: `D`, isCorrect: false },
                        { text: `Utilizam algoritmos de criptografia de chave pública.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `Funções de hash detectam alterações na mensagem.`
                },
                {
                    qIdPrefix: `rand_`, sourceRef: `[Fonte: ATIVIDADES PDF, p.3, Q4]`,
                    text: `(UFES/2014) O termo "Engenharia Social" ... NÃO caracteriza um caso de Engenharia Social o que está descrito em:`,
                    options: [
                        { text: `Ligação de falso administrador de sistemas solicitando passos.`, id: `A`, isCorrect: false },
                        { text: `E-mail sobre prêmio sorteado pedindo cadastro em site.`, id: `B`, isCorrect: false },
                        { text: `E-mail alertando sobre vírus perigoso e pedindo para excluir arquivo.`, id: `C`, isCorrect: false },
                        { text: `Ligação de falsa empresa pedindo dados pessoais para cadastro.`, id: `D`, isCorrect: false },
                        { text: `E-mail de site pedindo para clicar em link para confirmar cadastro.`, id: `E`, isCorrect: true }
                    ],
                    gabaritoComentado: `A confirmação de cadastro por e-mail é um procedimento comum e legítimo.`
                },
                {
                    qIdPrefix: `rand_`, sourceRef: `[Fonte: ATIVIDADES PDF, p.9, Q2 "Princípios"]`,
                    text: `Em relação à segurança física em um ambiente empresarial, qual das seguintes opções é um exemplo de controle que pode ser usado na primeira camada de segurança, ao se aproximar de uma instalação?`,
                    options: [
                        { text: `Firewalls.`, id: `A`, isCorrect: false }, { text: `Criptografia.`, id: `B`, isCorrect: false },
                        { text: `Catracas e elevadores.`, id: `C`, isCorrect: false }, { text: `Cancelas com seguranças verificando identificações.`, id: `D`, isCorrect: true },
                        { text: `Sistemas de detecção de intrusão.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `Cancelas com verificação de ID são um controle físico da primeira camada.`
                },
                {
                    qIdPrefix: `rand_`, sourceRef: `[Fonte: ATIVIDADES PDF, p.17, Q2 "Normas"]`,
                    text: `Qual é o principal objetivo da Norma ISO/IEC 27001?`,
                    options: [
                        { text: `Definir padrões para testes de penetração cibernética.`, id: `A`, isCorrect: false },
                        { text: `Prover requisitos para estabelecer, implementar, manter e melhorar continuamente um Sistema de Gestão de Segurança da Informação (SGSI).`, id: `B`, isCorrect: true },
                        { text: `Estabelecer diretrizes para o descarte seguro de dados organizacionais.`, id: `C`, isCorrect: false },
                        { text: `Fornecer um padrão para comunicações de rede seguras.`, id: `D`, isCorrect: false },
                        { text: `Criar uma estrutura para treinamento em segurança cibernética.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `A ISO/IEC 27001 estabelece os requisitos para um SGSI.`
                },
                {
                    qIdPrefix: `rand_`, sourceRef: `[Fonte: ATIVIDADES PDF, p.22, Q1 "Boas Práticas"]`,
                    text: `(AMEOSC/2022 - Adaptada) Protege o computador contra outros programas potencialmente danosos. Ele detecta, impede e atua na remoção de programas maliciosos... Marque a alternativa CORRETA...`,
                    options: [
                        { text: `Proxy.`, id: `A`, isCorrect: false }, { text: `Antivírus.`, id: `B`, isCorrect: true },
                        { text: `Firewall.`, id: `C`, isCorrect: false }, { text: `Painel de Controle.`, id: `D`, isCorrect: false },
                        { text: `Roteador.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `Antivírus é o software que detecta e remove malwares.`
                },
                {
                    qIdPrefix: `rand_`, sourceRef: `[Fonte: Prova AV.pdf, p.1, Q2]`,
                    text: `Na segurança da informação, a fragilidade de um ativo ou grupo de ativos, que pode ser explorada por uma ou mais ameaças, é chamada de:`,
                    options: [
                        { text: `Risco.`, id: `A`, isCorrect: false }, { text: `Incidente de segurança da informação.`, id: `B`, isCorrect: false },
                        { text: `Ameaça.`, id: `C`, isCorrect: false }, { text: `Vulnerabilidade.`, id: `D`, isCorrect: true },
                        { text: `Desastre.`, id: `E`, isCorrect: false }
                    ],
                    gabaritoComentado: `Vulnerabilidade é a fragilidade que pode ser explorada.`
                }
            ];

            let currentQuizQuestions = [];
            const questionsState = [];
            const questionsArea = document.getElementById('questions-area-main');
            const navGrid = document.getElementById('question-nav-grid');
            const finalizeButton = document.getElementById('finalize-button');
            const restartButton = document.getElementById('restart-button');
            const themeToggleButton = document.getElementById('theme-toggle-button');
            const answeredCountEl = document.getElementById('answered-count');
            const reviewCountEl = document.getElementById('review-count');
            const blankCountEl = document.getElementById('blank-count');
            let quizFinalized = false;

            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            function buildCurrentQuiz() {
                currentQuizQuestions = new Array(10).fill(null);
                const fixedMapping = [
                    { quizSlot: 0, fixedDefIndex: 0, displayNumber: '1' }, 
                    { quizSlot: 4, fixedDefIndex: 1, displayNumber: '5' }, 
                    { quizSlot: 5, fixedDefIndex: 2, displayNumber: '6' }, 
                    { quizSlot: 6, fixedDefIndex: 3, displayNumber: '7' }, 
                    { quizSlot: 7, fixedDefIndex: 4, displayNumber: '8' }
                ];
                
                fixedMapping.forEach(map => {
                    const questionData = JSON.parse(JSON.stringify(fixedQuestionDefinitions[map.fixedDefIndex]));
                    questionData.qId = `${questionData.qIdPrefix}slot${map.quizSlot}_${Date.now()}`; // ID único para cada instância
                    questionData.qNumberDisplay = map.displayNumber; 
                    currentQuizQuestions[map.quizSlot] = questionData;
                });

                const shuffledRandomPool = [...randomizableQuestionPool];
                shuffleArray(shuffledRandomPool);

                let randomPoolIdx = 0;
                const randomDisplayNumbers = ['2', '3', '4', '9', '10']; 
                let randomDisplayCounter = 0;

                for (let i = 0; i < 10; i++) {
                    if (currentQuizQuestions[i] === null) { 
                        if (randomPoolIdx < shuffledRandomPool.length) {
                            const questionData = JSON.parse(JSON.stringify(shuffledRandomPool[randomPoolIdx++]));
                            questionData.qId = `${questionData.qIdPrefix}slot${i}_rand${Date.now()}_${randomPoolIdx}`;
                            questionData.qNumberDisplay = randomDisplayNumbers[randomDisplayCounter++];
                            questionData.highlight = false;
                            currentQuizQuestions[i] = questionData;
                        } else {
                            // Fallback simples se o pool for menor que o necessário
                            currentQuizQuestions[i] = { qId: `empty_slot${i}_${Date.now()}`, qNumberDisplay: randomDisplayNumbers[randomDisplayCounter++] || `${i+1}`, text: `(Questão de fallback) Por favor, adicione mais questões ao 'randomizableQuestionPool'.`, options: [{text: 'Opção A', id:'A', isCorrect:true}], gabaritoComentado: `Pool de questões insuficiente.`};
                        }
                    }
                }
            }

            function initializeQuizState() {
                buildCurrentQuiz(); 
                questionsState.length = 0; 
                currentQuizQuestions.forEach(() => {
                    questionsState.push({
                        userSelectedOptionIndex: null, isAnswered: false, isMarkedForReview: false
                    });
                });
                quizFinalized = false;
                const savedTheme = localStorage.getItem('theme');
                const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;

                if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                    document.body.classList.add('dark-theme');
                    themeToggleButton.textContent = '☀️'; 
                } else {
                    document.body.classList.remove('dark-theme');
                    themeToggleButton.textContent = '🌙';
                }
            }

            function renderQuestions() {
                questionsArea.innerHTML = ''; navGrid.innerHTML = '';
                questionsArea.classList.remove('quiz-finalized');
                navGrid.classList.remove('quiz-finalized');

                currentQuizQuestions.forEach((qData, qIndex) => {
                    const qBlock = document.createElement('div');
                    qBlock.classList.add('question-block'); qBlock.id = qData.qId;
                    const qHeader = document.createElement('div');
                    qHeader.classList.add('question-block-header');
                    const qNum = document.createElement('span');
                    qNum.classList.add('question-block-number');
                    if (qData.highlight) qNum.classList.add('highlight-red');
                    qNum.textContent = `Questão ${qData.qNumberDisplay}`;
                    const reviewBtn = document.createElement('button');
                    reviewBtn.classList.add('question-block-review-btn');
                    reviewBtn.textContent = questionsState[qIndex].isMarkedForReview ? `Desmarcar Revisão` : `Marcar para Revisão`;
                    if(questionsState[qIndex].isMarkedForReview) reviewBtn.classList.add('marked');
                    reviewBtn.disabled = quizFinalized;
                    reviewBtn.addEventListener('click', () => toggleReview(qIndex));
                    qHeader.appendChild(qNum); qHeader.appendChild(reviewBtn);
                    const qText = document.createElement('div');
                    qText.classList.add('question-block-text'); qText.innerHTML = qData.text;
                    if (qData.sourceRef) {
                        const sourceSpan = document.createElement('span');
                        sourceSpan.classList.add('source-reference'); sourceSpan.textContent = qData.sourceRef;
                        qText.appendChild(sourceSpan);
                    }
                    const qOptionsUl = document.createElement('ul');
                    qOptionsUl.classList.add('question-block-options');
                    qData.options.forEach((opt, optIndex) => {
                        const optLi = document.createElement('li');
                        optLi.classList.add('option-item');
                        if (!quizFinalized && questionsState[qIndex].userSelectedOptionIndex === optIndex) {
                            optLi.classList.add('selected');
                        }
                        const optLetter = document.createElement('span');
                        optLetter.classList.add('option-letter'); optLetter.textContent = opt.id;
                        const optTextSpan = document.createElement('span');
                        optTextSpan.classList.add('option-text'); optTextSpan.innerHTML = opt.text;
                        optLi.appendChild(optLetter); optLi.appendChild(optTextSpan);
                        optLi.addEventListener('click', () => selectOption(qIndex, optIndex));
                        qOptionsUl.appendChild(optLi);
                    });
                    const feedbackDiv = document.createElement('div');
                    feedbackDiv.classList.add('gabarito-feedback'); feedbackDiv.style.display = 'none'; 
                    qBlock.appendChild(qHeader); qBlock.appendChild(qText);
                    qBlock.appendChild(qOptionsUl); qBlock.appendChild(feedbackDiv); 
                    questionsArea.appendChild(qBlock);
                    const navBtn = document.createElement('button');
                    navBtn.classList.add('nav-grid-button'); navBtn.textContent = qData.qNumberDisplay;
                    navBtn.addEventListener('click', () => {
                         document.getElementById(qData.qId).scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                    navBtn.classList.remove('nav-grid-correct', 'nav-grid-incorrect', 'nav-grid-unanswered');
                    if (questionsState[qIndex].isAnswered && !quizFinalized) navBtn.classList.add('answered');
                    if (questionsState[qIndex].isMarkedForReview && !quizFinalized) navBtn.classList.add('review');
                    navGrid.appendChild(navBtn);
                });
                
                finalizeButton.style.display = 'block';
                restartButton.style.display = 'none';
                finalizeButton.textContent = 'Finalizar Prova';
                updateStatusCounts(); // Chama para definir o estado inicial do botão finalizar
            }
            
            function selectOption(qIndex, optIndex) {
                if (quizFinalized) return;
                questionsState[qIndex].userSelectedOptionIndex = optIndex;
                questionsState[qIndex].isAnswered = true;
                const qBlock = document.getElementById(currentQuizQuestions[qIndex].qId);
                const optionItems = qBlock.querySelectorAll('.option-item');
                optionItems.forEach((item, currentOptIndex) => {
                    item.classList.toggle('selected', currentOptIndex === optIndex);
                });
                updateStatusCounts();
                updateNavGridButtonState(qIndex, false);
            }

            function toggleReview(qIndex) {
                if (quizFinalized) return;
                questionsState[qIndex].isMarkedForReview = !questionsState[qIndex].isMarkedForReview;
                const reviewBtn = document.getElementById(currentQuizQuestions[qIndex].qId).querySelector('.question-block-review-btn');
                reviewBtn.textContent = questionsState[qIndex].isMarkedForReview ? `Desmarcar Revisão` : `Marcar para Revisão`;
                reviewBtn.classList.toggle('marked', questionsState[qIndex].isMarkedForReview);
                updateStatusCounts(); // Apenas para atualizar o contador, não afeta o botão finalizar
                updateNavGridButtonState(qIndex, false);
            }

            function updateStatusCounts() {
                let answered = 0;
                let review = 0;
                questionsState.forEach(qState => {
                    if (qState.isAnswered) answered++;
                    if (qState.isMarkedForReview) review++;
                });
                answeredCountEl.textContent = answered;
                reviewCountEl.textContent = review;
                blankCountEl.textContent = currentQuizQuestions.length - answered;

                if (!quizFinalized) {
                    if (answered === currentQuizQuestions.length) {
                        finalizeButton.disabled = false;
                        finalizeButton.title = "Finalizar a prova";
                    } else {
                        finalizeButton.disabled = true;
                        finalizeButton.title = `Responda todas as ${currentQuizQuestions.length} questões para finalizar.`;
                    }
                }
            }

            function updateNavGridButtonState(qIndex, isFinalized) {
                const navButtons = navGrid.querySelectorAll('.nav-grid-button');
                const targetNavButton = Array.from(navButtons).find(btn => btn.textContent === currentQuizQuestions[qIndex].qNumberDisplay);
                if (targetNavButton) {
                    targetNavButton.classList.remove('answered', 'review', 'nav-grid-correct', 'nav-grid-incorrect', 'nav-grid-unanswered');
                    if (isFinalized) {
                        const userChoiceIndex = questionsState[qIndex].userSelectedOptionIndex;
                        const correctOptionIndex = currentQuizQuestions[qIndex].options.findIndex(opt => opt.isCorrect);
                        if (userChoiceIndex === null) { targetNavButton.classList.add('nav-grid-unanswered'); }
                        else if (userChoiceIndex === correctOptionIndex) { targetNavButton.classList.add('nav-grid-correct'); }
                        else { targetNavButton.classList.add('nav-grid-incorrect'); }
                    } else {
                        if (questionsState[qIndex].isAnswered) targetNavButton.classList.add('answered');
                        if (questionsState[qIndex].isMarkedForReview) targetNavButton.classList.add('review');
                    }
                }
            }
            
            finalizeButton.addEventListener('click', () => {
                if (quizFinalized || finalizeButton.disabled) return;
                quizFinalized = true;
                finalizeButton.disabled = true;
                finalizeButton.textContent = 'Prova Finalizada'; 
                finalizeButton.style.display = 'none';
                restartButton.style.display = 'block';
                questionsArea.classList.add('quiz-finalized');
                navGrid.classList.add('quiz-finalized');
                document.querySelectorAll('.question-block-review-btn').forEach(btn => btn.disabled = true);

                currentQuizQuestions.forEach((qData, qIndex) => {
                    const qBlock = document.getElementById(qData.qId);
                    const optionItems = qBlock.querySelectorAll('.option-item');
                    const feedbackDiv = qBlock.querySelector('.gabarito-feedback');
                    const userChoiceIndex = questionsState[qIndex].userSelectedOptionIndex;
                    const correctOptionObj = qData.options.find(opt => opt.isCorrect);
                    const correctOptionIndex = qData.options.indexOf(correctOptionObj);
                    let feedbackHTML = ``;
                    if (userChoiceIndex !== null) {
                        feedbackHTML += `<p><strong>Sua resposta:</strong> Opção ${qData.options[userChoiceIndex].id}</p>`;
                        if (userChoiceIndex === correctOptionIndex) {
                            feedbackDiv.className = 'gabarito-feedback correct'; 
                            feedbackHTML += `<p><strong>Resultado:</strong> Correto!</p>`;
                            optionItems[userChoiceIndex].classList.add('user-correct');
                        } else {
                            feedbackDiv.className = 'gabarito-feedback incorrect';
                            feedbackHTML += `<p><strong>Resultado:</strong> Incorreto.</p>`;
                            optionItems[userChoiceIndex].classList.add('user-incorrect');
                        }
                    } else {
                        feedbackDiv.className = 'gabarito-feedback incorrect'; 
                        feedbackHTML += `<p><strong>Sua resposta:</strong> Nenhuma opção selecionada.</p>`;
                        feedbackHTML += `<p><strong>Resultado:</strong> Incorreto.</p>`;
                    }
                    feedbackHTML += `<p><strong>Resposta correta:</strong> Opção ${correctOptionObj.id} - ${correctOptionObj.text}</p>`;
                    if (qData.gabaritoComentado) {
                        feedbackHTML += `<p class="gabarito-comentario"><strong>Comentário:</strong> ${qData.gabaritoComentado}</p>`;
                    }
                    feedbackDiv.innerHTML = feedbackHTML;
                    feedbackDiv.style.display = 'block';
                    if (correctOptionIndex !== -1) optionItems[correctOptionIndex].classList.add('actual-correct');
                    optionItems.forEach(optItem => {
                        optItem.style.cursor = 'default';
                        optItem.classList.remove('selected');
                    });
                    updateNavGridButtonState(qIndex, true); 
                });
            });

            restartButton.addEventListener('click', () => {
                initializeQuizState(); 
                renderQuestions();
            });
            
            themeToggleButton.addEventListener('click', () => {
                document.body.classList.toggle('dark-theme');
                const isDarkMode = document.body.classList.contains('dark-theme');
                localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
                themeToggleButton.textContent = isDarkMode ? '☀️' : '🌙';
            });

            initializeQuizState(); 
            renderQuestions();
        });
    </script>
</body>
</html>